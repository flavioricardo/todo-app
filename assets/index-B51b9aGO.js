import{j as e,T as t,a as s,t as a,b as r}from"./components-small-Rzwon3i3.js";import{r as n,l as o,C as i,m as c,n as l,B as d,F as u,o as g}from"./vendor-gestalt-C7yLN_Hx.js";import{d as m,k as f,s as h,l as p,G as y,o as j,m as w,n as k,p as S}from"./vendor-firebase-CEKj6m-j.js";import{A as x}from"./component-header-C4_ZdN9H.js";import{L as b}from"./component-login-BhILTMTE.js";import{T}from"./component-tasklist-wdNQ6P-R.js";import{d as E,a as v,t as L}from"./services-B5jg6WFc.js";import{s as C,u as P}from"./utils-DX2N1SK1.js";import{a as O}from"./vendor-react-BtDQ8f-S.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const I="users",M={async getUserPreferences(e){try{const t=m(E,I,e),s=await p(t);return s.exists()?s.data():{theme:C.get("theme","lightWash"),language:C.get("language","pt")}}catch(t){throw t}},async saveUserPreferences(e,t){try{const s=m(E,I,e);return await f(s,{...t,updatedAt:h()},{merge:!0}),t}catch(s){throw s}},async updatePreference(e,t,s){try{const a=m(E,I,e);return await f(a,{[t]:s,updatedAt:h()},{merge:!0}),{[t]:s}}catch(a){throw a}}};function W(){const[m,f]=n.useState(C.get("theme","lightWash")),[h,p]=n.useState(C.get("language","pt")),[E,O]=n.useState(!1),[I,W]=n.useState(""),[A,R]=n.useState([]),[U,$]=n.useState(""),[D,G]=n.useState("all"),[N,B]=n.useState(!1),[F,q]=n.useState(null),[z,K]=n.useState(!1),H=new y,J=P(),Q=new o(10),V=new i([Q]);n.useEffect((()=>{F&&M.updatePreference(F.uid,"theme",m),C.set("theme",m)}),[m,F]),n.useEffect((()=>{F&&M.updatePreference(F.uid,"language",h),C.set("language",h)}),[h,F]),n.useEffect((()=>{if(!F){const e=C.get("tasks",[]);R(e)}}),[]),n.useEffect((()=>{const e=j(v,(async e=>{if(q(e),e){B(!0);try{const t=await L.syncTasks(e.uid);R(t),C.set("tasks",t);const s=await M.getUserPreferences(e.uid);s&&(s.theme&&f(s.theme),s.language&&p(s.language)),X("Tasks and preferences synced successfully!")}catch(t){X("Error syncing data")}finally{B(!1)}}}));return()=>e()}),[]),n.useEffect((()=>{F||C.set("tasks",A)}),[A,F]);const X=e=>{W(e),O(!0),setTimeout((()=>O(!1)),3e3)},Y=async()=>{try{await S(v),q(null);const e=C.get("tasks",[]);R(e)}catch(e){X(a[h].signOutError)}},Z=A.filter((e=>{const t=e.text.toLowerCase().includes(U.toLowerCase());return"completed"===D?t&&e.completed:"pending"===D?t&&!e.completed:t}));return e.jsx(c,{deviceType:J?"mobile":"desktop",children:e.jsx(l,{colorScheme:m,children:e.jsxs(d,{as:"main",margin:"auto",padding:4,width:"100%",color:"lightWash"===m?"lightWash":"dark",rounding:0,justifyContent:"center",display:"block",height:"100vh",children:[e.jsx(x,{theme:m,language:h,isMobile:J,user:F,toggleTheme:()=>{f("lightWash"===m?"dark":"lightWash")},setLanguage:e=>{p(e)},handleSignOut:Y,setOpenLoginModal:K,syncData:async()=>{if(!F)return X(a[h].needLogin),void K(!0);B(!0);try{const e=await L.syncTasks(F.uid);R(e),C.set("tasks",e),await M.saveUserPreferences(F.uid,{theme:m,language:h}),X(a[h].syncSuccess)}catch(e){X(a[h].syncError)}finally{B(!1)}}}),e.jsx(b,{isOpen:z,onClose:()=>K(!1),onLoginEmail:async(e,t)=>{try{const s=await w(v,e,t);q(s.user),K(!1)}catch(s){X(`${a[h].loginEmailError}: ${s.message}`)}},onLoginGoogle:async()=>{try{const e=await k(v,H);q(e.user),K(!1)}catch(e){X(`${a[h].loginGoogleError}: ${e.message}`)}},onSignOut:Y,user:F,language:h,zIndex:V}),e.jsx(t,{onAddTask:async(e,t)=>{const s={id:Date.now().toString(),text:e,category:t,completed:!1};B(!0);try{if(F){B(!0);const e=await L.addTask(s,F.uid);R((t=>[...t,e]))}else R((e=>[...e,s]))}catch(r){X(a[h].addTaskError)}finally{B(!1)}},language:h,isMobile:J,disabled:N}),e.jsx(s,{searchTerm:U,filterStatus:D,onSearchChange:$,onFilterChange:G,language:h,isMobile:J,disabled:N}),N?e.jsx(u,{alignItems:"center",justifyContent:"center",height:"200px",children:e.jsx(g,{show:!0,accessibilityLabel:a[h].loadingTasks})}):e.jsx(T,{tasks:Z,onToggleTask:async e=>{try{const t=A.find((t=>t.id===e));if(!t)return;const s={...t,completed:!t.completed};F&&s.firebaseId&&(B(!0),await L.updateTask(s,F.uid));const a=A.map((t=>t.id===e?s:t));R(a)}catch(t){X(a[h].updateTaskError)}finally{B(!1)}},onClearCompleted:async()=>{try{const e=A.filter((e=>e.completed)),t=A.filter((e=>!e.completed));if(F){B(!0);for(const t of e)t.firebaseId&&await L.deleteTask(t.firebaseId)}R(t),X(a[h].clearCompletedSuccess)}catch(e){X(a[h].clearCompletedError)}finally{B(!1)}},filterStatus:D,language:h,isMobile:J}),e.jsx(r,{show:E,message:I,onDismiss:()=>O(!1),language:h})]})})})}function A(){return e.jsx(W,{})}var R,U={};var $=function(){if(R)return U;R=1;var e=O();return U.createRoot=e.createRoot,U.hydrateRoot=e.hydrateRoot,U}();const D=document.getElementById("root");D&&$.createRoot(D).render(e.jsx(n.StrictMode,{children:e.jsx(A,{})}));
