import{j as e,T as t,a as s,t as a,b as r}from"./components-small-CDiwPkPf.js";import{r as o,k as n,l as c,B as i,b as u,m as l}from"./vendor-gestalt-CqUovwVg.js";import{a as d}from"./vendor-react-BtDQ8f-S.js";import{d as g,k as m,s as f,l as y,G as h,o as p,m as C,n as j,p as k}from"./vendor-firebase-Cfr0B36E.js";import{A as w}from"./component-header-DxxaD7fy.js";import{L as S}from"./component-login-B6fosBSx.js";import{T as b,c as v}from"./component-tasklist-CuCRFnTT.js";import{d as x,a as E,t as T}from"./services-CnbXrmsw.js";import{s as L,u as B}from"./utils-D79wK9W_.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var P,O={};var A=function(){if(P)return O;P=1;var e=d();return O.createRoot=e.createRoot,O.hydrateRoot=e.hydrateRoot,O}();const I="users",M={async getUserPreferences(e){try{const t=g(x,I,e),s=await y(t);return s.exists()?s.data():{theme:L.get("theme","lightWash"),language:L.get("language","pt")}}catch(t){throw t}},async saveUserPreferences(e,t){try{const s=g(x,I,e);return await m(s,{...t,updatedAt:f()},{merge:!0}),t}catch(s){throw s}},async updatePreference(e,t,s){try{const a=g(x,I,e);return await m(a,{[t]:s,updatedAt:f()},{merge:!0}),{[t]:s}}catch(a){throw a}}};function R(){const[d,g]=o.useState(L.get("theme","lightWash")),[m,f]=o.useState(L.get("language","pt")),[y,x]=o.useState(!1),[P,O]=o.useState(""),[A,I]=o.useState(L.getCustomCategories()),[R,W]=o.useState([]),[U,D]=o.useState(""),[G,$]=o.useState("all"),[N,q]=o.useState(L.get("groupBy","none")),[F,K]=o.useState(!1),[z,H]=o.useState(null),[J,Q]=o.useState(!1),V=new h,X=B();o.useEffect((()=>{z&&M.updatePreference(z.uid,"theme",d),L.set("theme",d)}),[d,z]),o.useEffect((()=>{z&&M.updatePreference(z.uid,"language",m),L.set("language",m)}),[m,z]),o.useEffect((()=>{z&&M.updatePreference(z.uid,"groupBy",N),L.set("groupBy",N)}),[N,z]),o.useEffect((()=>{if(!z){const e=L.get("tasks",[]);W(e)}}),[]),o.useEffect((()=>{const e=p(E,(async e=>{if(H(e),e){K(!0);try{const t=await T.syncTasks(e.uid);W(t),L.set("tasks",t);const s=await M.getUserPreferences(e.uid);s&&(s.theme&&g(s.theme),s.language&&f(s.language),s.groupBy&&q(s.groupBy),s.customCategories&&(I(s.customCategories),L.set("customCategories",s.customCategories))),Y("Tasks and preferences synced successfully!")}catch(t){Y("Error syncing data")}finally{K(!1)}}}));return()=>e()}),[]),o.useEffect((()=>{z||L.set("tasks",R)}),[R,z]);const Y=e=>{O(e),x(!0),setTimeout((()=>x(!1)),3e3)},Z=async()=>{try{await k(E),H(null);const e=L.get("tasks",[]);W(e)}catch(e){Y(a[m].signOutError)}},_=R.filter((e=>{const t=e.text.toLowerCase().includes(U.toLowerCase());return"completed"===G?t&&e.completed:"pending"===G?t&&!e.completed:t}));return e.jsx(n,{deviceType:X?"mobile":"desktop",children:e.jsx(c,{colorScheme:d,children:e.jsxs(i,{as:"main",margin:"auto",padding:4,width:"100%",color:"lightWash"===d?"lightWash":"dark",rounding:0,justifyContent:"center",display:"block",height:"100vh",children:[e.jsx(w,{theme:d,language:m,isMobile:X,user:z,toggleTheme:()=>{g("lightWash"===d?"dark":"lightWash")},setLanguage:e=>{f(e)},handleSignOut:Z,setOpenLoginModal:Q,syncData:async()=>{if(!z)return Y(a[m].needLogin),void Q(!0);K(!0);try{const e=await T.syncTasks(z.uid);W(e),L.set("tasks",e),await M.saveUserPreferences(z.uid,{theme:d,language:m,groupBy:N,customCategories:A}),Y(a[m].syncSuccess)}catch(e){Y(a[m].syncError)}finally{K(!1)}}}),e.jsx(S,{isOpen:J,onClose:()=>Q(!1),onLoginEmail:async(e,t)=>{try{const s=await C(E,e,t);H(s.user),Q(!1)}catch(s){Y(`${a[m].loginEmailError}: ${s.message}`)}},onLoginGoogle:async()=>{try{const e=await j(E,V);H(e.user),Q(!1)}catch(e){Y(`${a[m].loginGoogleError}: ${e.message}`)}},onSignOut:Z,user:z,language:m}),e.jsx(t,{onAddTask:async(e,t)=>{const s={id:Date.now().toString(),text:e,category:t,completed:!1};K(!0);try{if(z){K(!0);const e=await T.addTask(s,z.uid);W((t=>[...t,e]))}else W((e=>[...e,s]))}catch(r){Y(a[m].addTaskError)}finally{K(!1)}},language:m,isMobile:X,disabled:F,customCategories:A,onAddCategory:async e=>{try{if(z){const t=await v.addCustomCategory(z.uid,e);I(t)}else{const t=L.addCustomCategory(e);I(t)}Y(a[m].categoryAdded)}catch(t){Y(a[m].error)}},onRemoveCategory:async e=>{try{if(R.some((t=>t.category===e)))return void Y(a[m].categoryInUse);if(z){const t=await M.removeCustomCategory(z.uid,e);I(t)}else{const t=L.removeCustomCategory(e);I(t)}Y(a[m].categoryDeleted)}catch(t){Y(a[m].error)}},user:z}),e.jsx(s,{searchTerm:U,filterStatus:G,groupBy:N,onSearchChange:D,onFilterChange:$,onGroupByChange:q,language:m,isMobile:X,disabled:F}),F?e.jsx(u,{alignItems:"center",justifyContent:"center",height:"200px",children:e.jsx(l,{show:!0,accessibilityLabel:a[m].loadingTasks})}):e.jsx(b,{tasks:_,onToggleTask:async e=>{try{const t=R.find((t=>t.id===e));if(!t)return;const s={...t,completed:!t.completed};z&&s.firebaseId&&(K(!0),await T.updateTask(s,z.uid));const a=R.map((t=>t.id===e?s:t));W(a)}catch(t){Y(a[m].updateTaskError)}finally{K(!1)}},onClearCompleted:async()=>{try{const e=R.filter((e=>e.completed)),t=R.filter((e=>!e.completed));if(z){K(!0);for(const t of e)t.firebaseId&&await T.deleteTask(t.firebaseId)}W(t),Y(a[m].clearCompletedSuccess)}catch(e){Y(a[m].clearCompletedError)}finally{K(!1)}},filterStatus:G,groupBy:N,language:m,isMobile:X}),e.jsx(r,{show:y,message:P,onDismiss:()=>x(!1),language:m})]})})})}function W(){return e.jsx(R,{})}const U=document.getElementById("root");U&&A.createRoot(U).render(e.jsx(o.StrictMode,{children:e.jsx(W,{})}));
