import{P as e,j as s,T as t,a}from"./ui-components-form-Bk1A3duM.js";import{r,L as o,A as i,l as n,B as c,d as l,b as d,c as u,T as g,a as h,m,n as y,o as f,f as p}from"./vendor-gestalt-k6pdCueW.js";import{a as j}from"./vendor-react-BtDQ8f-S.js";import{A as x,a as C,T as S}from"./ui-components-core-CFYL7dkO.js";import{G as b,o as w,m as k,n as v,p as E}from"./vendor-firebase-Da0mNW5k.js";import{L as T}from"./ui-components-auth-CdojRL5z.js";import{s as L,u as I,a as R,t as B,c as O}from"./app-services-Dsij0ipy.js";import{t as M}from"./app-constants-CVKmY58-.js";import{z as P,s as U,u as W}from"./app-utils-DAXUT7p0.js";import{T as N}from"./ui-components-task-duJhQkPS.js";import"./vendor-prop-types-Bx5UHif0.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)})).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();var q,A={};var z=function(){if(q)return A;q=1;var e=j();return A.createRoot=e.createRoot,A.hydrateRoot=e.hydrateRoot,A}();function D({isOpen:e,onClose:t,categories:a,language:y,user:f,onShareCategory:p,onRemoveShare:j}){const[x,C]=r.useState(""),[S,b]=r.useState(""),[w,k]=r.useState("share"),[v,E]=r.useState(!1),[T,I]=r.useState([]),[R,B]=r.useState([]);r.useEffect((()=>{e&&f&&O()}),[e,f]);const O=async()=>{if(f){E(!0);try{const e=await L.getMyShares(f.uid);I(e);const s=await L.getSharedWithMe(f.uid);B(s)}catch(e){}finally{E(!1)}}},U=async()=>{if(x&&S&&f){E(!0);try{await p(x,S),b(""),C(""),O()}catch(e){}finally{E(!1)}}};return e?s.jsx(o,{zIndex:P,children:s.jsxs(i,{accessibilityLabel:M[y].shareCategory,heading:M[y].shareCategory,onDismiss:t,footer:s.jsx(c,{display:"flex",justifyContent:"end",padding:2,children:s.jsx(l,{text:M[y].close,onClick:t})}),size:"md",children:[s.jsx(n,{activeTabIndex:"share"===w?0:1,onChange:({activeTabIndex:e})=>{k(0===e?"share":"list")},tabs:[{text:M[y].shareWithUser,id:"share"},{text:M[y].sharing,id:"list"}]}),"share"===w?s.jsxs(c,{padding:4,children:[s.jsx(c,{marginBottom:4,children:s.jsx(d,{id:"categoryToShare",label:M[y].taskCategory,onChange:({value:e})=>C(e),placeholder:M[y].taskCategory,value:x,disabled:v,children:a.map((e=>s.jsx(d.Option,{label:M[y].categories[e]||e,value:e},e)))})}),s.jsx(c,{marginBottom:4,children:s.jsx(u,{id:"targetEmail",onChange:({value:e})=>b(e),placeholder:M[y].emailPlaceholder,label:M[y].shareWith,value:S,type:"email",disabled:v})}),s.jsx(l,{text:M[y].shareCategory,color:"blue",onClick:U,disabled:!x||!S||v})]}):s.jsxs(c,{padding:4,marginTop:2,children:[s.jsx(g,{weight:"bold",children:M[y].sharedByMe}),0===T.length?s.jsx(c,{padding:2,children:s.jsx(g,{children:M[y].noCustomCategories})}):T.map((e=>s.jsxs(h,{alignItems:"center",justifyContent:"between",gap:2,children:[s.jsxs(c,{flex:"grow",children:[s.jsx(g,{weight:"bold",children:M[y].categories[e.categoryName]||e.categoryName}),s.jsx(g,{size:"100",children:e.targetEmail})]}),s.jsx(l,{text:M[y].removeShare,onClick:()=>(async e=>{E(!0);try{await j(e),O()}catch(s){}finally{E(!1)}})(e.id),color:"red",size:"sm",disabled:v})]},e.id))),s.jsxs(c,{marginTop:4,children:[s.jsx(g,{weight:"bold",children:M[y].sharedWithMe}),0===R.length?s.jsx(c,{padding:2,children:s.jsx(g,{children:M[y].noCustomCategories})}):R.map((e=>s.jsxs(h,{alignItems:"center",gap:2,children:[s.jsx(m,{icon:"person",accessibilityLabel:"User",color:"darkGray"}),s.jsxs(c,{children:[s.jsx(g,{weight:"bold",children:M[y].categories[e.categoryName]||e.categoryName}),s.jsx(g,{size:"100",children:e.targetEmail})]})]},e.id)))]})]})]})}):null}function G(){const[e,o]=r.useState(U.get("theme","lightWash")),[i,n]=r.useState(U.get("language","pt")),[l,d]=r.useState(!1),[u,g]=r.useState(""),[m,j]=r.useState(U.getCustomCategories()),[P,q]=r.useState([]),[A,z]=r.useState(""),[G,$]=r.useState("all"),[F,K]=r.useState(U.get("groupBy","none")),[Y,H]=r.useState(!0),[J,Q]=r.useState([]),[V,X]=r.useState(!1),[Z,_]=r.useState(null),[ee,se]=r.useState(!1),[te,ae]=r.useState(!1),re=new b,oe=W();r.useEffect((()=>{Z&&I.updatePreference(Z.uid,"theme",e),U.set("theme",e)}),[e,Z]),r.useEffect((()=>{Z&&I.updatePreference(Z.uid,"language",i),U.set("language",i)}),[i,Z]),r.useEffect((()=>{Z&&I.updatePreference(Z.uid,"groupBy",F),U.set("groupBy",F)}),[F,Z]),r.useEffect((()=>{if(!Z){const e=U.get("tasks",[]);q(e)}}),[]),r.useEffect((()=>{const e=w(R,(async e=>{if(_(e),e){H(!0);try{const s=await B.syncTasks(e.uid);q(s),U.set("tasks",s);const t=await I.getUserPreferences(e.uid);t&&(t.theme&&o(t.theme),t.language&&n(t.language),t.groupBy&&K(t.groupBy));const a=await O.getUserCategories(e.uid);a&&a.length>0&&(j(a),U.set("customCategories",a)),ie(M[i].syncSuccess)}catch(s){ie("Error syncing data")}finally{H(!1)}}}));return()=>e()}),[]),r.useEffect((()=>{Z||U.set("tasks",P)}),[P,Z]);const ie=e=>{g(e),d(!0),setTimeout((()=>d(!1)),3e3)},ne=async()=>{try{await E(R),_(null);const e=U.get("tasks",[]);q(e)}catch(e){ie(M[i].signOutError)}},ce=P.filter((e=>{const s=e.text.toLowerCase().includes(A.toLowerCase());return"completed"===G?s&&e.completed:"pending"===G?s&&!e.completed:s}));return s.jsx(y,{deviceType:oe?"mobile":"desktop",children:s.jsx(f,{colorScheme:e,children:s.jsxs(c,{as:"main",margin:"auto",padding:4,width:"100%",color:"lightWash"===e?"lightWash":"dark",rounding:0,justifyContent:"center",display:"block",children:[s.jsx(x,{theme:e,language:i,isMobile:oe,user:Z,toggleTheme:()=>{o("lightWash"===e?"dark":"lightWash")},setLanguage:e=>{n(e)},handleSignOut:ne,setOpenLoginModal:se,syncData:async()=>{if(!Z)return ie(M[i].needLogin),void se(!0);H(!0);try{const s=await B.syncTasks(Z.uid);q(s),U.set("tasks",s),await I.saveUserPreferences(Z.uid,{theme:e,language:i,groupBy:F}),await O.saveCategories(Z.uid,m),ie(M[i].syncSuccess)}catch(s){ie(M[i].syncError)}finally{H(!1)}},onOpenShareModal:ae}),s.jsx(T,{isOpen:ee,onClose:()=>se(!1),onLoginEmail:async(e,s)=>{try{const t=await k(R,e,s);_(t.user),se(!1),await I.ensureUserEmail(t.user.reloadUserInfo.localId)}catch(t){ie(`${M[i].loginEmailError}: ${t.message}`)}},onLoginGoogle:async()=>{try{const e=await v(R,re);_(e.user),se(!1),await I.ensureUserEmail(e.user.reloadUserInfo.localId)}catch(e){ie(`${M[i].loginGoogleError}: ${e.message}`)}},onSignOut:ne,user:Z,language:i}),s.jsx(D,{isOpen:te,onClose:()=>ae(!1),categories:[...Object.keys(M[i].categories),...m],language:i,user:Z,onShareCategory:async(e,s)=>{if(Z)try{const t=await L.shareCategory(e,Z.uid,s);return ie(M[i].shareCategorySuccess),t}catch(t){let e=M[i].shareCategoryError;throw"User not found"===t.message?e=M[i].userNotFound:"Cannot share with yourself"===t.message&&(e=M[i].cannotShareWithYourself),ie(e),t}else ie(M[i].needLogin)},onRemoveShare:async e=>{if(Z)try{await L.removeShare(e),ie(M[i].removeShareSuccess)}catch(s){throw ie(M[i].removeShareError),s}else ie(M[i].needLogin)}}),s.jsx(C,{id:"forms-accordion",accessibilityExpandLabel:"Expandir seção",accessibilityCollapseLabel:"Recolher seção",defaultExpandedIndices:[0,1],items:[{icon:"edit",children:s.jsx(t,{onAddTask:async(e,s)=>{const t={id:Date.now().toString(),text:e,category:s,completed:!1};X(!0);try{if(Z){const e=await B.addTask(t,Z.uid);q((s=>[...s,e]))}else q((e=>[...e,t]))}catch(a){ie(M[i].addTaskError)}finally{X(!1)}},language:i,isMobile:oe,disabled:Y||V,customCategories:m,onAddCategory:async e=>{try{if(Z){const s=await O.addCustomCategory(Z.uid,e);j(s),U.set("customCategories",s)}else{const s=U.addCustomCategory(e);j(s)}ie(M[i].categoryAdded)}catch(s){ie(M[i].error)}},onRemoveCategory:async e=>{try{if(P.some((s=>s.category===e)))return void ie(M[i].categoryInUse);if(Z){const s=await O.removeCustomCategory(Z.uid,e);j(s),U.set("customCategories",s)}else{const s=U.removeCustomCategory(e);j(s)}ie(M[i].categoryDeleted)}catch(s){ie(M[i].error)}},user:Z,isAddingTask:V}),title:M[i].addTaskPlaceholder},{icon:"filter",children:s.jsx(a,{searchTerm:A,filterStatus:G,groupBy:F,onSearchChange:z,onFilterChange:$,onGroupByChange:K,language:i,isMobile:oe,disabled:Y}),title:M[i].filterPlaceholder}]}),Y?s.jsx(h,{alignItems:"center",flex:"grow",justifyContent:"center",children:s.jsx(c,{height:"100vh",marginTop:12,children:s.jsx(p,{show:!0,accessibilityLabel:M[i].loadingTasks})})}):s.jsx(N,{tasks:ce,onToggleTask:async e=>{try{const s=P.find((s=>s.id===e));if(!s)return;Q((s=>[...s,e]));const t={...s,completed:!s.completed};Z&&t.firebaseId&&await B.updateTask(t,Z.uid);const a=P.map((s=>s.id===e?t:s));q(a)}catch(s){ie(M[i].updateTaskError)}finally{Q((s=>s.filter((s=>s!==e))))}},onClearCompleted:async()=>{try{const e=P.filter((e=>e.completed)),s=e.map((e=>e.id)),t=P.filter((e=>!e.completed));if(Q((e=>[...e,...s])),Z)for(const a of e)a.firebaseId&&await B.deleteTask(a.firebaseId);q(t),ie(M[i].clearCompletedSuccess)}catch(e){ie(M[i].clearCompletedError)}finally{Q([])}},filterStatus:G,groupBy:F,language:i,isMobile:oe,loadingTaskIds:J}),s.jsx(S,{show:l,message:u,onDismiss:()=>d(!1),language:i})]})})})}function $(){return s.jsx(G,{})}D.propTypes={isOpen:e.bool.isRequired,onClose:e.func.isRequired,categories:e.array.isRequired,language:e.string.isRequired,user:e.object,onShareCategory:e.func.isRequired,onRemoveShare:e.func.isRequired};const F=document.getElementById("root");F&&z.createRoot(F).render(s.jsx(r.StrictMode,{children:s.jsx($,{})}));
