import{j as e,T as t,a as s}from"./ui-components-form-D6-4KZXb.js";import{r as a,k as o,l as r,B as n,b as i,m as c}from"./vendor-gestalt-C-ehLyim.js";import{a as l}from"./vendor-react-BtDQ8f-S.js";import{A as u,a as d,T as g}from"./ui-components-core-DpkoANcz.js";import{G as m,o as f,m as p,n as y,p as h}from"./vendor-firebase-d_gnxxo4.js";import{L as C}from"./ui-components-auth-BEf0PiWq.js";import{T as j}from"./ui-components-task-BhttLfYR.js";import{u as k,a as S,t as b,c as w}from"./app-services-0pdvdrwl.js";import{s as x,u as E}from"./app-utils-DKuicV5P.js";import{t as T}from"./app-constants-CBaLPq-s.js";import"./vendor-prop-types-Bx5UHif0.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var v,L={};var B=function(){if(v)return L;v=1;var e=l();return L.createRoot=e.createRoot,L.hydrateRoot=e.hydrateRoot,L}();function P(){const[l,v]=a.useState(x.get("theme","lightWash")),[L,B]=a.useState(x.get("language","pt")),[P,I]=a.useState(!1),[O,M]=a.useState(""),[R,A]=a.useState(x.getCustomCategories()),[W,D]=a.useState([]),[G,U]=a.useState(""),[$,N]=a.useState("all"),[q,F]=a.useState(x.get("groupBy","none")),[K,z]=a.useState(!1),[H,J]=a.useState(null),[Q,V]=a.useState(!1),X=new m,Y=E();a.useEffect((()=>{H&&k.updatePreference(H.uid,"theme",l),x.set("theme",l)}),[l,H]),a.useEffect((()=>{H&&k.updatePreference(H.uid,"language",L),x.set("language",L)}),[L,H]),a.useEffect((()=>{H&&k.updatePreference(H.uid,"groupBy",q),x.set("groupBy",q)}),[q,H]),a.useEffect((()=>{if(!H){const e=x.get("tasks",[]);D(e)}}),[]),a.useEffect((()=>{const e=f(S,(async e=>{if(J(e),e){z(!0);try{const t=await b.syncTasks(e.uid);D(t),x.set("tasks",t);const s=await k.getUserPreferences(e.uid);s&&(s.theme&&v(s.theme),s.language&&B(s.language),s.groupBy&&F(s.groupBy));const a=await w.getUserCategories(e.uid);a&&a.length>0&&(A(a),x.set("customCategories",a)),Z(T[L].syncSuccess)}catch(t){Z("Error syncing data")}finally{z(!1)}}}));return()=>e()}),[]),a.useEffect((()=>{H||x.set("tasks",W)}),[W,H]);const Z=e=>{M(e),I(!0),setTimeout((()=>I(!1)),3e3)},_=async()=>{try{await h(S),J(null);const e=x.get("tasks",[]);D(e)}catch(e){Z(T[L].signOutError)}},ee=W.filter((e=>{const t=e.text.toLowerCase().includes(G.toLowerCase());return"completed"===$?t&&e.completed:"pending"===$?t&&!e.completed:t}));return e.jsx(o,{deviceType:Y?"mobile":"desktop",children:e.jsx(r,{colorScheme:l,children:e.jsxs(n,{as:"main",margin:"auto",padding:4,width:"100%",color:"lightWash"===l?"lightWash":"dark",rounding:0,justifyContent:"center",display:"block",children:[e.jsx(u,{theme:l,language:L,isMobile:Y,user:H,toggleTheme:()=>{v("lightWash"===l?"dark":"lightWash")},setLanguage:e=>{B(e)},handleSignOut:_,setOpenLoginModal:V,syncData:async()=>{if(!H)return Z(T[L].needLogin),void V(!0);z(!0);try{const e=await b.syncTasks(H.uid);D(e),x.set("tasks",e),await k.saveUserPreferences(H.uid,{theme:l,language:L,groupBy:q}),await w.saveCategories(H.uid,R),Z(T[L].syncSuccess)}catch(e){Z(T[L].syncError)}finally{z(!1)}}}),e.jsx(C,{isOpen:Q,onClose:()=>V(!1),onLoginEmail:async(e,t)=>{try{const s=await p(S,e,t);J(s.user),V(!1)}catch(s){Z(`${T[L].loginEmailError}: ${s.message}`)}},onLoginGoogle:async()=>{try{const e=await y(S,X);J(e.user),V(!1)}catch(e){Z(`${T[L].loginGoogleError}: ${e.message}`)}},onSignOut:_,user:H,language:L}),e.jsx(d,{id:"forms-accordion",accessibilityExpandLabel:"Expandir seção",accessibilityCollapseLabel:"Recolher seção",defaultExpandedIndices:[0,1],items:[{icon:"edit",children:e.jsx(t,{onAddTask:async(e,t)=>{const s={id:Date.now().toString(),text:e,category:t,completed:!1};z(!0);try{if(H){z(!0);const e=await b.addTask(s,H.uid);D((t=>[...t,e]))}else D((e=>[...e,s]))}catch(a){Z(T[L].addTaskError)}finally{z(!1)}},language:L,isMobile:Y,disabled:K,customCategories:R,onAddCategory:async e=>{try{if(H){const t=await w.addCustomCategory(H.uid,e);A(t),x.set("customCategories",t)}else{const t=x.addCustomCategory(e);A(t)}Z(T[L].categoryAdded)}catch(t){Z(T[L].error)}},onRemoveCategory:async e=>{try{if(W.some((t=>t.category===e)))return void Z(T[L].categoryInUse);if(H){const t=await w.removeCustomCategory(H.uid,e);A(t),x.set("customCategories",t)}else{const t=x.removeCustomCategory(e);A(t)}Z(T[L].categoryDeleted)}catch(t){Z(T[L].error)}},user:H}),title:T[L].addTaskPlaceholder},{icon:"filter",children:e.jsx(s,{searchTerm:G,filterStatus:$,groupBy:q,onSearchChange:U,onFilterChange:N,onGroupByChange:F,language:L,isMobile:Y,disabled:K}),title:T[L].filterPlaceholder}]}),K?e.jsx(i,{alignItems:"center",justifyContent:"center",height:"200px",children:e.jsx(c,{show:!0,accessibilityLabel:T[L].loadingTasks})}):e.jsx(j,{tasks:ee,onToggleTask:async e=>{try{const t=W.find((t=>t.id===e));if(!t)return;const s={...t,completed:!t.completed};H&&s.firebaseId&&(z(!0),await b.updateTask(s,H.uid));const a=W.map((t=>t.id===e?s:t));D(a)}catch(t){Z(T[L].updateTaskError)}finally{z(!1)}},onClearCompleted:async()=>{try{const e=W.filter((e=>e.completed)),t=W.filter((e=>!e.completed));if(H){z(!0);for(const t of e)t.firebaseId&&await b.deleteTask(t.firebaseId)}D(t),Z(T[L].clearCompletedSuccess)}catch(e){Z(T[L].clearCompletedError)}finally{z(!1)}},filterStatus:$,groupBy:q,language:L,isMobile:Y}),e.jsx(g,{show:P,message:O,onDismiss:()=>I(!1),language:L})]})})})}function I(){return e.jsx(P,{})}const O=document.getElementById("root");O&&B.createRoot(O).render(e.jsx(a.StrictMode,{children:e.jsx(I,{})}));
