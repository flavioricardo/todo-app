import{j as e,T as t,a as s,t as a,b as r}from"./components-small-CDiwPkPf.js";import{r as o,k as n,l as c,B as i,b as u,m as g}from"./vendor-gestalt-CqUovwVg.js";import{a as l}from"./vendor-react-BtDQ8f-S.js";import{d,k as m,s as y,l as f,e as h,c as p,q as C,h as w,j,G as k,o as S,m as b,n as v,p as E}from"./vendor-firebase-G-DTV4qV.js";import{A as x}from"./component-header-DxxaD7fy.js";import{L as T}from"./component-login-B6fosBSx.js";import{T as L}from"./component-tasklist-C-nzWcd2.js";import{d as B,a as P,t as I}from"./services-Da4KMEWA.js";import{s as A,u as O}from"./utils-C-GecFoB.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var U,$={};var M=function(){if(U)return $;U=1;var e=l();return $.createRoot=e.createRoot,$.hydrateRoot=e.hydrateRoot,$}();const R="users",W={async getUserPreferences(e){try{const t=d(B,R,e),s=await f(t);return s.exists()?s.data():{theme:A.get("theme","lightWash"),language:A.get("language","pt")}}catch(t){throw t}},async saveUserPreferences(e,t){try{const s=d(B,R,e);return await m(s,{...t,updatedAt:y()},{merge:!0}),t}catch(s){throw s}},async updatePreference(e,t,s){try{const a=d(B,R,e);return await m(a,{[t]:s,updatedAt:y()},{merge:!0}),{[t]:s}}catch(a){throw a}}},D="categories",G={async getUserCategories(e){try{const t=p(B,D),s=C(t,w("userId","==",e)),a=await j(s),r=[];return a.forEach((e=>{r.push(e.data().name)})),0===r.length?A.getCustomCategories():r}catch(t){throw t}},async addCustomCategory(e,t){try{const s=d(B,D,`${e}_${t}`);await m(s,{userId:e,name:t,createdAt:y()});const a=A.getCustomCategories();return a.includes(t)||A.set("customCategories",[...a,t]),await this.getUserCategories(e)}catch(s){throw s}},async removeCustomCategory(e,t){try{const s=d(B,D,`${e}_${t}`);await h(s);const a=A.getCustomCategories();return A.set("customCategories",a.filter((e=>e!==t))),await this.getUserCategories(e)}catch(s){throw s}}};function N(){const[l,d]=o.useState(A.get("theme","lightWash")),[m,y]=o.useState(A.get("language","pt")),[f,h]=o.useState(!1),[p,C]=o.useState(""),[w,j]=o.useState(A.getCustomCategories()),[B,U]=o.useState([]),[$,M]=o.useState(""),[R,D]=o.useState("all"),[N,q]=o.useState(A.get("groupBy","none")),[_,F]=o.useState(!1),[K,z]=o.useState(null),[H,J]=o.useState(!1),Q=new k,V=O();o.useEffect((()=>{K&&W.updatePreference(K.uid,"theme",l),A.set("theme",l)}),[l,K]),o.useEffect((()=>{K&&W.updatePreference(K.uid,"language",m),A.set("language",m)}),[m,K]),o.useEffect((()=>{K&&W.updatePreference(K.uid,"groupBy",N),A.set("groupBy",N)}),[N,K]),o.useEffect((()=>{if(!K){const e=A.get("tasks",[]);U(e)}}),[]),o.useEffect((()=>{const e=S(P,(async e=>{if(z(e),e){F(!0);try{const t=await I.syncTasks(e.uid);U(t),A.set("tasks",t);const s=await W.getUserPreferences(e.uid);s&&(s.theme&&d(s.theme),s.language&&y(s.language),s.groupBy&&q(s.groupBy),s.customCategories&&(j(s.customCategories),A.set("customCategories",s.customCategories))),X("Tasks and preferences synced successfully!")}catch(t){X("Error syncing data")}finally{F(!1)}}}));return()=>e()}),[]),o.useEffect((()=>{K||A.set("tasks",B)}),[B,K]);const X=e=>{C(e),h(!0),setTimeout((()=>h(!1)),3e3)},Y=async()=>{try{await E(P),z(null);const e=A.get("tasks",[]);U(e)}catch(e){X(a[m].signOutError)}},Z=B.filter((e=>{const t=e.text.toLowerCase().includes($.toLowerCase());return"completed"===R?t&&e.completed:"pending"===R?t&&!e.completed:t}));return e.jsx(n,{deviceType:V?"mobile":"desktop",children:e.jsx(c,{colorScheme:l,children:e.jsxs(i,{as:"main",margin:"auto",padding:4,width:"100%",color:"lightWash"===l?"lightWash":"dark",rounding:0,justifyContent:"center",display:"block",height:"100vh",children:[e.jsx(x,{theme:l,language:m,isMobile:V,user:K,toggleTheme:()=>{d("lightWash"===l?"dark":"lightWash")},setLanguage:e=>{y(e)},handleSignOut:Y,setOpenLoginModal:J,syncData:async()=>{if(!K)return X(a[m].needLogin),void J(!0);F(!0);try{const e=await I.syncTasks(K.uid);U(e),A.set("tasks",e),await W.saveUserPreferences(K.uid,{theme:l,language:m,groupBy:N,customCategories:w}),X(a[m].syncSuccess)}catch(e){X(a[m].syncError)}finally{F(!1)}}}),e.jsx(T,{isOpen:H,onClose:()=>J(!1),onLoginEmail:async(e,t)=>{try{const s=await b(P,e,t);z(s.user),J(!1)}catch(s){X(`${a[m].loginEmailError}: ${s.message}`)}},onLoginGoogle:async()=>{try{const e=await v(P,Q);z(e.user),J(!1)}catch(e){X(`${a[m].loginGoogleError}: ${e.message}`)}},onSignOut:Y,user:K,language:m}),e.jsx(t,{onAddTask:async(e,t)=>{const s={id:Date.now().toString(),text:e,category:t,completed:!1};F(!0);try{if(K){F(!0);const e=await I.addTask(s,K.uid);U((t=>[...t,e]))}else U((e=>[...e,s]))}catch(r){X(a[m].addTaskError)}finally{F(!1)}},language:m,isMobile:V,disabled:_,customCategories:w,onAddCategory:async e=>{try{if(K){const t=await G.addCustomCategory(K.uid,e);j(t)}else{const t=A.addCustomCategory(e);j(t)}X(a[m].categoryAdded)}catch(t){X(a[m].error)}},onRemoveCategory:async e=>{try{if(B.some((t=>t.category===e)))return void X(a[m].categoryInUse);if(K){const t=await W.removeCustomCategory(K.uid,e);j(t)}else{const t=A.removeCustomCategory(e);j(t)}X(a[m].categoryDeleted)}catch(t){X(a[m].error)}},user:K}),e.jsx(s,{searchTerm:$,filterStatus:R,groupBy:N,onSearchChange:M,onFilterChange:D,onGroupByChange:q,language:m,isMobile:V,disabled:_}),_?e.jsx(u,{alignItems:"center",justifyContent:"center",height:"200px",children:e.jsx(g,{show:!0,accessibilityLabel:a[m].loadingTasks})}):e.jsx(L,{tasks:Z,onToggleTask:async e=>{try{const t=B.find((t=>t.id===e));if(!t)return;const s={...t,completed:!t.completed};K&&s.firebaseId&&(F(!0),await I.updateTask(s,K.uid));const a=B.map((t=>t.id===e?s:t));U(a)}catch(t){X(a[m].updateTaskError)}finally{F(!1)}},onClearCompleted:async()=>{try{const e=B.filter((e=>e.completed)),t=B.filter((e=>!e.completed));if(K){F(!0);for(const t of e)t.firebaseId&&await I.deleteTask(t.firebaseId)}U(t),X(a[m].clearCompletedSuccess)}catch(e){X(a[m].clearCompletedError)}finally{F(!1)}},filterStatus:R,groupBy:N,language:m,isMobile:V}),e.jsx(r,{show:f,message:p,onDismiss:()=>h(!1),language:m})]})})})}function q(){return e.jsx(N,{})}const _=document.getElementById("root");_&&M.createRoot(_).render(e.jsx(o.StrictMode,{children:e.jsx(q,{})}));
