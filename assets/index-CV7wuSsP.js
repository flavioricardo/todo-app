import{P as e,j as t,t as s,T as a,a as r,b as o}from"./components-small-Dz8sz-BQ.js";import{r as n,B as i,k as c,l,m as d,b as u,n as g}from"./vendor-gestalt-BRg-26zS.js";import{a as m}from"./vendor-react-BtDQ8f-S.js";import{d as f,k as p,s as y,l as h,G as b,o as x,m as C,n as E,p as j}from"./vendor-firebase-Cfr0B36E.js";import{A as k}from"./component-header-COzBVCQX.js";import{L as w}from"./component-login-C94NksyN.js";import{T as S,c as L}from"./component-tasklist-BCFsf0aJ.js";import{d as T,a as v,t as P}from"./services-BZ9SVSX1.js";import{s as B,u as I}from"./utils-DWkyBxVi.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var O,R={};var A=function(){if(O)return R;O=1;var e=m();return R.createRoot=e.createRoot,R.hydrateRoot=e.hydrateRoot,R}();function $({items:e,id:s,accessibilityExpandLabel:a,accessibilityCollapseLabel:r,defaultExpandedIndices:o=[],onExpandedChange:l}){const[d,u]=n.useState(o);return t.jsx(i,{children:e.map(((e,o)=>{const n=d.includes(o);return t.jsx(i,{marginTop:2,marginBottom:2,children:t.jsx(c.Expandable,{id:`${s}-module-${o}`,accessibilityCollapseLabel:r,accessibilityExpandLabel:a,items:[e],expandedIndex:n?0:null,onExpandedChange:()=>(e=>{let t;t=d.includes(e)?d.filter((t=>t!==e)):[...d,e],u(t),l&&l(t)})(o)})},`${s}-item-${o}`)}))})}$.propTypes={items:e.arrayOf(e.shape({title:e.string.isRequired,icon:e.string,iconButton:e.element,summary:e.arrayOf(e.string),type:e.oneOf(["info","error"]),iconAccessibilityLabel:e.string,children:e.node,badge:e.object})).isRequired,id:e.string.isRequired,accessibilityExpandLabel:e.string.isRequired,accessibilityCollapseLabel:e.string.isRequired,defaultExpandedIndices:e.arrayOf(e.number),onExpandedChange:e.func},$.defaultProps={defaultExpandedIndices:[],onExpandedChange:void 0};const M="users",q={async getUserPreferences(e){try{const t=f(T,M,e),s=await h(t);return s.exists()?s.data():{theme:B.get("theme","lightWash"),language:B.get("language","pt")}}catch(t){throw t}},async saveUserPreferences(e,t){try{const s=f(T,M,e);return await p(s,{...t,updatedAt:y()},{merge:!0}),t}catch(s){throw s}},async updatePreference(e,t,s){try{const a=f(T,M,e);return await p(a,{[t]:s,updatedAt:y()},{merge:!0}),{[t]:s}}catch(a){throw a}}};function W(){const[e,c]=n.useState(B.get("theme","lightWash")),[m,f]=n.useState(B.get("language","pt")),[p,y]=n.useState(!1),[h,T]=n.useState(""),[O,R]=n.useState(B.getCustomCategories()),[A,M]=n.useState([]),[W,U]=n.useState(""),[D,G]=n.useState("all"),[N,F]=n.useState(B.get("groupBy","none")),[K,z]=n.useState(!1),[H,J]=n.useState(null),[Q,V]=n.useState(!1),X=new b,Y=I();n.useEffect((()=>{H&&q.updatePreference(H.uid,"theme",e),B.set("theme",e)}),[e,H]),n.useEffect((()=>{H&&q.updatePreference(H.uid,"language",m),B.set("language",m)}),[m,H]),n.useEffect((()=>{H&&q.updatePreference(H.uid,"groupBy",N),B.set("groupBy",N)}),[N,H]),n.useEffect((()=>{if(!H){const e=B.get("tasks",[]);M(e)}}),[]),n.useEffect((()=>{const e=x(v,(async e=>{if(J(e),e){z(!0);try{const t=await P.syncTasks(e.uid);M(t),B.set("tasks",t);const a=await q.getUserPreferences(e.uid);a&&(a.theme&&c(a.theme),a.language&&f(a.language),a.groupBy&&F(a.groupBy),a.customCategories&&(R(a.customCategories),B.set("customCategories",a.customCategories))),Z(s[m].syncSuccess)}catch(t){Z("Error syncing data")}finally{z(!1)}}}));return()=>e()}),[]),n.useEffect((()=>{H||B.set("tasks",A)}),[A,H]);const Z=e=>{T(e),y(!0),setTimeout((()=>y(!1)),3e3)},_=async()=>{try{await j(v),J(null);const e=B.get("tasks",[]);M(e)}catch(e){Z(s[m].signOutError)}},ee=A.filter((e=>{const t=e.text.toLowerCase().includes(W.toLowerCase());return"completed"===D?t&&e.completed:"pending"===D?t&&!e.completed:t}));return t.jsx(l,{deviceType:Y?"mobile":"desktop",children:t.jsx(d,{colorScheme:e,children:t.jsxs(i,{as:"main",margin:"auto",padding:4,width:"100%",color:"lightWash"===e?"lightWash":"dark",rounding:0,justifyContent:"center",display:"block",children:[t.jsx(k,{theme:e,language:m,isMobile:Y,user:H,toggleTheme:()=>{c("lightWash"===e?"dark":"lightWash")},setLanguage:e=>{f(e)},handleSignOut:_,setOpenLoginModal:V,syncData:async()=>{if(!H)return Z(s[m].needLogin),void V(!0);z(!0);try{const t=await P.syncTasks(H.uid);M(t),B.set("tasks",t),await q.saveUserPreferences(H.uid,{theme:e,language:m,groupBy:N,customCategories:O}),Z(s[m].syncSuccess)}catch(t){Z(s[m].syncError)}finally{z(!1)}}}),t.jsx(w,{isOpen:Q,onClose:()=>V(!1),onLoginEmail:async(e,t)=>{try{const s=await C(v,e,t);J(s.user),V(!1)}catch(a){Z(`${s[m].loginEmailError}: ${a.message}`)}},onLoginGoogle:async()=>{try{const e=await E(v,X);J(e.user),V(!1)}catch(e){Z(`${s[m].loginGoogleError}: ${e.message}`)}},onSignOut:_,user:H,language:m}),t.jsx($,{id:"forms-accordion",accessibilityExpandLabel:"Expandir seção",accessibilityCollapseLabel:"Recolher seção",defaultExpandedIndices:[0,1],items:[{icon:"edit",children:t.jsx(a,{onAddTask:async(e,t)=>{const a={id:Date.now().toString(),text:e,category:t,completed:!1};z(!0);try{if(H){z(!0);const e=await P.addTask(a,H.uid);M((t=>[...t,e]))}else M((e=>[...e,a]))}catch(r){Z(s[m].addTaskError)}finally{z(!1)}},language:m,isMobile:Y,disabled:K,customCategories:O,onAddCategory:async e=>{try{if(H){const t=await L.addCustomCategory(H.uid,e);R(t)}else{const t=B.addCustomCategory(e);R(t)}Z(s[m].categoryAdded)}catch(t){Z(s[m].error)}},onRemoveCategory:async e=>{try{if(A.some((t=>t.category===e)))return void Z(s[m].categoryInUse);if(H){const t=await q.removeCustomCategory(H.uid,e);R(t)}else{const t=B.removeCustomCategory(e);R(t)}Z(s[m].categoryDeleted)}catch(t){Z(s[m].error)}},user:H}),title:s[m].addTaskPlaceholder},{icon:"filter",children:t.jsx(r,{searchTerm:W,filterStatus:D,groupBy:N,onSearchChange:U,onFilterChange:G,onGroupByChange:F,language:m,isMobile:Y,disabled:K}),title:s[m].filterPlaceholder}]}),K?t.jsx(u,{alignItems:"center",justifyContent:"center",height:"200px",children:t.jsx(g,{show:!0,accessibilityLabel:s[m].loadingTasks})}):t.jsx(S,{tasks:ee,onToggleTask:async e=>{try{const t=A.find((t=>t.id===e));if(!t)return;const s={...t,completed:!t.completed};H&&s.firebaseId&&(z(!0),await P.updateTask(s,H.uid));const a=A.map((t=>t.id===e?s:t));M(a)}catch(t){Z(s[m].updateTaskError)}finally{z(!1)}},onClearCompleted:async()=>{try{const e=A.filter((e=>e.completed)),t=A.filter((e=>!e.completed));if(H){z(!0);for(const t of e)t.firebaseId&&await P.deleteTask(t.firebaseId)}M(t),Z(s[m].clearCompletedSuccess)}catch(e){Z(s[m].clearCompletedError)}finally{z(!1)}},filterStatus:D,groupBy:N,language:m,isMobile:Y}),t.jsx(o,{show:p,message:h,onDismiss:()=>y(!1),language:m})]})})})}function U(){return t.jsx(W,{})}const D=document.getElementById("root");D&&A.createRoot(D).render(t.jsx(n.StrictMode,{children:t.jsx(U,{})}));
