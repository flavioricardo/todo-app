import{i as s,g as a,a as t,b as e,w as r,d,s as i,c as o,e as c,u as n,f,q as u,h as p,j as I}from"./vendor-firebase-Cfr0B36E.js";import{s as h}from"./utils-D79wK9W_.js";const w=s({apiKey:"AIzaSyD4HbsUM4VnVfccf81cDQzg3fSN4zL2qY0",authDomain:"todoapp-5140d.firebaseapp.com",projectId:"todoapp-5140d",storageBucket:"todoapp-5140d.firebasestorage.app",messagingSenderId:"867891118649",appId:"1:867891118649:web:4e7ab2480aa50a884d43e8",measurementId:"G-W1QWEMVE3X"});"undefined"!=typeof window&&a(w);const b=t(w),y=e(w),m="tasks",g={async getUserTasks(s){try{const a=u(o(b,m),p("userId","==",s)),t=await I(a),e=[];return t.forEach((s=>{e.push({...s.data(),id:s.id,firebaseId:s.id})})),e}catch(a){throw a}},async addTask(s,a){try{const t={...s,userId:a,createdAt:i(),updatedAt:i()},e=await f(o(b,m),t);return{...s,id:e.id,firebaseId:e.id}}catch(t){throw t}},async updateTask(s,a){try{const{firebaseId:t}=s;if(!t)throw new Error("Firebase ID missing");const e=d(b,m,t);return await n(e,{...s,userId:a,updatedAt:i()}),s}catch(t){throw t}},async deleteTask(s){try{return await c(d(b,m,s)),s}catch(a){throw a}},async syncTasks(s){try{const a=h.get("tasks",[]);if(0===a.length)return await this.getUserTasks(s);const t=await this.getUserTasks(s),e=r(b),c=a.filter((s=>!s.firebaseId&&!t.some((a=>a.id===s.id))));for(const r of c){const a={...r,userId:s,createdAt:i(),updatedAt:i()},t=d(o(b,m));e.set(t,a),r.firebaseId=t.id}await e.commit();const n=[...t];for(const s of a)if(s.firebaseId){const a=n.findIndex((a=>a.firebaseId===s.firebaseId));a>=0&&(n[a]=s)}else n.push(s);return n}catch(a){throw a}},async syncTaskList(s,a){try{const t=r(b);for(const e of s)if(e.firebaseId){const s=d(b,m,e.firebaseId);t.update(s,{...e,userId:a,updatedAt:i()})}else{const s={...e,userId:a,createdAt:i(),updatedAt:i()},r=d(o(b,m));t.set(r,s),e.firebaseId=r.id}return await t.commit(),s}catch(t){throw t}}};export{y as a,b as d,g as t};
