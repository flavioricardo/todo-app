import{P as e,j as t,T as s,a}from"./ui-components-form-C6ySaX2X.js";import{r,L as o,A as i,k as n,B as c,d as l,b as d,c as u,T as g,a as h,l as m,m as y,n as f,o as p}from"./vendor-gestalt-CzAJx8OM.js";import{a as j}from"./vendor-react-BtDQ8f-S.js";import{A as x,a as C,T as S}from"./ui-components-core-DevzHc19.js";import{G as b,o as w,m as k,n as v,p as E}from"./vendor-firebase-Da0mNW5k.js";import{L as T}from"./ui-components-auth-D7u7qF_h.js";import{s as L,u as I,a as R,t as B,c as O}from"./app-services-91wEGV88.js";import{t as M}from"./app-constants-CVKmY58-.js";import{z as P,s as U,u as W}from"./app-utils-Cm9Jlpz9.js";import{T as N}from"./ui-components-task-C6low-xI.js";import"./vendor-prop-types-Bx5UHif0.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var q,z={};var A=function(){if(q)return z;q=1;var e=j();return z.createRoot=e.createRoot,z.hydrateRoot=e.hydrateRoot,z}();function D({isOpen:e,onClose:s,categories:a,language:y,user:f,onShareCategory:p,onRemoveShare:j}){const[x,C]=r.useState(""),[S,b]=r.useState(""),[w,k]=r.useState("share"),[v,E]=r.useState(!1),[T,I]=r.useState([]),[R,B]=r.useState([]);r.useEffect((()=>{e&&f&&O()}),[e,f]);const O=async()=>{if(f){E(!0);try{const e=await L.getMyShares(f.uid);I(e);const t=await L.getSharedWithMe(f.uid);B(t)}catch(e){}finally{E(!1)}}},U=async()=>{if(x&&S&&f){E(!0);try{await p(x,S),b(""),C(""),O()}catch(e){}finally{E(!1)}}};return e?t.jsx(o,{zIndex:P,children:t.jsxs(i,{accessibilityLabel:M[y].shareCategory,heading:M[y].shareCategory,onDismiss:s,footer:t.jsx(c,{display:"flex",justifyContent:"end",padding:2,children:t.jsx(l,{text:M[y].close,onClick:s})}),size:"md",children:[t.jsx(n,{activeTabIndex:"share"===w?0:1,onChange:({activeTabIndex:e})=>{k(0===e?"share":"list")},tabs:[{text:M[y].shareWithUser,id:"share"},{text:M[y].sharing,id:"list"}]}),"share"===w?t.jsxs(c,{padding:4,children:[t.jsx(c,{marginBottom:4,children:t.jsx(d,{id:"categoryToShare",label:M[y].taskCategory,onChange:({value:e})=>C(e),placeholder:M[y].taskCategory,value:x,disabled:v,children:a.map((e=>t.jsx(d.Option,{label:M[y].categories[e]||e,value:e},e)))})}),t.jsx(c,{marginBottom:4,children:t.jsx(u,{id:"targetEmail",onChange:({value:e})=>b(e),placeholder:M[y].emailPlaceholder,label:M[y].shareWith,value:S,type:"email",disabled:v})}),t.jsx(l,{text:M[y].shareCategory,color:"blue",onClick:U,disabled:!x||!S||v})]}):t.jsxs(c,{padding:4,marginTop:2,children:[t.jsx(g,{weight:"bold",children:M[y].sharedByMe}),0===T.length?t.jsx(c,{padding:2,children:t.jsx(g,{children:M[y].noCustomCategories})}):T.map((e=>t.jsxs(h,{alignItems:"center",justifyContent:"between",gap:2,children:[t.jsxs(c,{flex:"grow",children:[t.jsx(g,{weight:"bold",children:M[y].categories[e.categoryName]||e.categoryName}),t.jsx(g,{size:"100",children:e.targetEmail})]}),t.jsx(l,{text:M[y].removeShare,onClick:()=>(async e=>{E(!0);try{await j(e),O()}catch(t){}finally{E(!1)}})(e.id),color:"red",size:"sm",disabled:v})]},e.id))),t.jsxs(c,{marginTop:4,children:[t.jsx(g,{weight:"bold",children:M[y].sharedWithMe}),0===R.length?t.jsx(c,{padding:2,children:t.jsx(g,{children:M[y].noCustomCategories})}):R.map((e=>t.jsxs(h,{alignItems:"center",gap:2,children:[t.jsx(m,{icon:"person",accessibilityLabel:"User",color:"darkGray"}),t.jsxs(c,{children:[t.jsx(g,{weight:"bold",children:M[y].categories[e.categoryName]||e.categoryName}),t.jsx(g,{size:"100",children:e.targetEmail})]})]},e.id)))]})]})]})}):null}function G(){const[e,o]=r.useState(U.get("theme","lightWash")),[i,n]=r.useState(U.get("language","pt")),[l,d]=r.useState(!1),[u,g]=r.useState(""),[m,j]=r.useState(U.getCustomCategories()),[P,q]=r.useState([]),[z,A]=r.useState(""),[G,$]=r.useState("all"),[F,K]=r.useState(U.get("groupBy","none")),[Y,H]=r.useState(!1),[J,Q]=r.useState(null),[V,X]=r.useState(!1),[Z,_]=r.useState(!1),ee=new b,te=W();r.useEffect((()=>{J&&I.updatePreference(J.uid,"theme",e),U.set("theme",e)}),[e,J]),r.useEffect((()=>{J&&I.updatePreference(J.uid,"language",i),U.set("language",i)}),[i,J]),r.useEffect((()=>{J&&I.updatePreference(J.uid,"groupBy",F),U.set("groupBy",F)}),[F,J]),r.useEffect((()=>{if(!J){const e=U.get("tasks",[]);q(e)}}),[]),r.useEffect((()=>{const e=w(R,(async e=>{if(Q(e),e){H(!0);try{const t=await B.syncTasks(e.uid);q(t),U.set("tasks",t);const s=await I.getUserPreferences(e.uid);s&&(s.theme&&o(s.theme),s.language&&n(s.language),s.groupBy&&K(s.groupBy));const a=await O.getUserCategories(e.uid);a&&a.length>0&&(j(a),U.set("customCategories",a)),se(M[i].syncSuccess)}catch(t){se("Error syncing data")}finally{H(!1)}}}));return()=>e()}),[]),r.useEffect((()=>{J||U.set("tasks",P)}),[P,J]);const se=e=>{g(e),d(!0),setTimeout((()=>d(!1)),3e3)},ae=async()=>{try{await E(R),Q(null);const e=U.get("tasks",[]);q(e)}catch(e){se(M[i].signOutError)}},re=P.filter((e=>{const t=e.text.toLowerCase().includes(z.toLowerCase());return"completed"===G?t&&e.completed:"pending"===G?t&&!e.completed:t}));return t.jsx(y,{deviceType:te?"mobile":"desktop",children:t.jsx(f,{colorScheme:e,children:t.jsxs(c,{as:"main",margin:"auto",padding:4,width:"100%",color:"lightWash"===e?"lightWash":"dark",rounding:0,justifyContent:"center",display:"block",children:[t.jsx(x,{theme:e,language:i,isMobile:te,user:J,toggleTheme:()=>{o("lightWash"===e?"dark":"lightWash")},setLanguage:e=>{n(e)},handleSignOut:ae,setOpenLoginModal:X,syncData:async()=>{if(!J)return se(M[i].needLogin),void X(!0);H(!0);try{const t=await B.syncTasks(J.uid);q(t),U.set("tasks",t),await I.saveUserPreferences(J.uid,{theme:e,language:i,groupBy:F}),await O.saveCategories(J.uid,m),se(M[i].syncSuccess)}catch(t){se(M[i].syncError)}finally{H(!1)}},onOpenShareModal:_}),t.jsx(T,{isOpen:V,onClose:()=>X(!1),onLoginEmail:async(e,t)=>{try{const s=await k(R,e,t);Q(s.user),X(!1),await I.ensureUserEmail(s.user.reloadUserInfo.localId)}catch(s){se(`${M[i].loginEmailError}: ${s.message}`)}},onLoginGoogle:async()=>{try{const e=await v(R,ee);Q(e.user),X(!1),await I.ensureUserEmail(e.user.reloadUserInfo.localId)}catch(e){se(`${M[i].loginGoogleError}: ${e.message}`)}},onSignOut:ae,user:J,language:i}),t.jsx(D,{isOpen:Z,onClose:()=>_(!1),categories:[...Object.keys(M[i].categories),...m],language:i,user:J,onShareCategory:async(e,t)=>{if(J)try{const s=await L.shareCategory(e,J.uid,t);return se(M[i].shareCategorySuccess),s}catch(s){let e=M[i].shareCategoryError;throw"User not found"===s.message?e=M[i].userNotFound:"Cannot share with yourself"===s.message&&(e=M[i].cannotShareWithYourself),se(e),s}else se(M[i].needLogin)},onRemoveShare:async e=>{if(J)try{await L.removeShare(e),se(M[i].removeShareSuccess)}catch(t){throw se(M[i].removeShareError),t}else se(M[i].needLogin)}}),t.jsx(C,{id:"forms-accordion",accessibilityExpandLabel:"Expandir seção",accessibilityCollapseLabel:"Recolher seção",defaultExpandedIndices:[0,1],items:[{icon:"edit",children:t.jsx(s,{onAddTask:async(e,t)=>{const s={id:Date.now().toString(),text:e,category:t,completed:!1};H(!0);try{if(J){H(!0);const e=await B.addTask(s,J.uid);q((t=>[...t,e]))}else q((e=>[...e,s]))}catch(a){se(M[i].addTaskError)}finally{H(!1)}},language:i,isMobile:te,disabled:Y,customCategories:m,onAddCategory:async e=>{try{if(J){const t=await O.addCustomCategory(J.uid,e);j(t),U.set("customCategories",t)}else{const t=U.addCustomCategory(e);j(t)}se(M[i].categoryAdded)}catch(t){se(M[i].error)}},onRemoveCategory:async e=>{try{if(P.some((t=>t.category===e)))return void se(M[i].categoryInUse);if(J){const t=await O.removeCustomCategory(J.uid,e);j(t),U.set("customCategories",t)}else{const t=U.removeCustomCategory(e);j(t)}se(M[i].categoryDeleted)}catch(t){se(M[i].error)}},user:J}),title:M[i].addTaskPlaceholder},{icon:"filter",children:t.jsx(a,{searchTerm:z,filterStatus:G,groupBy:F,onSearchChange:A,onFilterChange:$,onGroupByChange:K,language:i,isMobile:te,disabled:Y}),title:M[i].filterPlaceholder}]}),Y?t.jsx(h,{alignItems:"center",justifyContent:"center",height:"200px",children:t.jsx(p,{show:!0,accessibilityLabel:M[i].loadingTasks})}):t.jsx(N,{tasks:re,onToggleTask:async e=>{try{const t=P.find((t=>t.id===e));if(!t)return;const s={...t,completed:!t.completed};J&&s.firebaseId&&(H(!0),await B.updateTask(s,J.uid));const a=P.map((t=>t.id===e?s:t));q(a)}catch(t){se(M[i].updateTaskError)}finally{H(!1)}},onClearCompleted:async()=>{try{const e=P.filter((e=>e.completed)),t=P.filter((e=>!e.completed));if(J){H(!0);for(const t of e)t.firebaseId&&await B.deleteTask(t.firebaseId)}q(t),se(M[i].clearCompletedSuccess)}catch(e){se(M[i].clearCompletedError)}finally{H(!1)}},filterStatus:G,groupBy:F,language:i,isMobile:te}),t.jsx(S,{show:l,message:u,onDismiss:()=>d(!1),language:i})]})})})}function $(){return t.jsx(G,{})}D.propTypes={isOpen:e.bool.isRequired,onClose:e.func.isRequired,categories:e.array.isRequired,language:e.string.isRequired,user:e.object,onShareCategory:e.func.isRequired,onRemoveShare:e.func.isRequired};const F=document.getElementById("root");F&&A.createRoot(F).render(t.jsx(r.StrictMode,{children:t.jsx($,{})}));
