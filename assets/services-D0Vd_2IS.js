import{i as a,g as s,a as t,b as e,w as r,d,s as o,c as i,e as c,u as n,f,q as u,h as p,j as I}from"./vendor-firebase-CmEgKLsZ.js";import{s as h}from"./utils-DX2N1SK1.js";const w=a({apiKey:"AIzaSyD4HbsUM4VnVfccf81cDQzg3fSN4zL2qY0",authDomain:"todoapp-5140d.firebaseapp.com",projectId:"todoapp-5140d",storageBucket:"todoapp-5140d.firebasestorage.app",messagingSenderId:"867891118649",appId:"1:867891118649:web:4e7ab2480aa50a884d43e8",measurementId:"G-W1QWEMVE3X"});"undefined"!=typeof window&&s(w);const b=t(w),y=e(w),m="tasks",g={async getUserTasks(a){try{const s=u(i(b,m),p("userId","==",a)),t=await I(s),e=[];return t.forEach((a=>{e.push({...a.data(),id:a.id,firebaseId:a.id})})),e}catch(s){throw s}},async addTask(a,s){try{const t={...a,userId:s,createdAt:o(),updatedAt:o()},e=await f(i(b,m),t);return{...a,id:e.id,firebaseId:e.id}}catch(t){throw t}},async updateTask(a,s){try{const{firebaseId:t}=a;if(!t)throw new Error("ID do Firebase ausente");const e=d(b,m,t);return await n(e,{...a,userId:s,updatedAt:o()}),a}catch(t){throw t}},async deleteTask(a){try{return await c(d(b,m,a)),a}catch(s){throw s}},async syncTasks(a){try{const s=h.get("tasks",[]);if(0===s.length)return await this.getUserTasks(a);const t=await this.getUserTasks(a),e=r(b),c=s.filter((a=>!a.firebaseId&&!t.some((s=>s.id===a.id))));for(const r of c){const s={...r,userId:a,createdAt:o(),updatedAt:o()},t=d(i(b,m));e.set(t,s),r.firebaseId=t.id}await e.commit();const n=[...t];for(const a of s)if(a.firebaseId){const s=n.findIndex((s=>s.firebaseId===a.firebaseId));s>=0&&(n[s]=a)}else n.push(a);return n}catch(s){throw s}},async syncTaskList(a,s){try{const t=r(b);for(const e of a)if(e.firebaseId){const a=d(b,m,e.firebaseId);t.update(a,{...e,userId:s,updatedAt:o()})}else{const a={...e,userId:s,createdAt:o(),updatedAt:o()},r=d(i(b,m));t.set(r,a),e.firebaseId=r.id}return await t.commit(),a}catch(t){throw t}}};export{y as a,g as t};
