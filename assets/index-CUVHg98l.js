import{P as e,j as t,T as a,a as s}from"./ui-components-form-BMap5DMW.js";import{r,L as o,A as i,l as n,B as c,d as l,b as d,c as u,T as g,a as h,m,n as y,o as f,f as p}from"./vendor-gestalt-k6pdCueW.js";import{a as j}from"./vendor-react-BtDQ8f-S.js";import{A as x,a as C,T as S}from"./ui-components-core-q7XHSeE4.js";import{G as b,o as w,m as k,n as v,p as T}from"./vendor-firebase-Da0mNW5k.js";import{L as E}from"./ui-components-auth-CbZGsMZ3.js";import{s as L,u as I,a as R,t as B,c as O}from"./app-services-DIS2-Mem.js";import{t as M}from"./app-constants-wElj3pIu.js";import{z as P,s as U,u as W}from"./app-utils-DAXUT7p0.js";import{T as N}from"./ui-components-task-Dx-lYh0o.js";import"./vendor-prop-types-Bx5UHif0.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var q,A={};var z=function(){if(q)return A;q=1;var e=j();return A.createRoot=e.createRoot,A.hydrateRoot=e.hydrateRoot,A}();function D({isOpen:e,onClose:a,categories:s,language:y,user:f,onShareCategory:p,onRemoveShare:j}){const[x,C]=r.useState(""),[S,b]=r.useState(""),[w,k]=r.useState("share"),[v,T]=r.useState(!1),[E,I]=r.useState([]),[R,B]=r.useState([]);r.useEffect((()=>{e&&f&&O()}),[e,f]);const O=async()=>{if(f){T(!0);try{const e=await L.getMyShares(f.uid);I(e);const t=await L.getSharedWithMe(f.uid);B(t)}catch(e){}finally{T(!1)}}},U=async()=>{if(x&&S&&f){T(!0);try{await p(x,S),b(""),C(""),O()}catch(e){}finally{T(!1)}}};return e?t.jsx(o,{zIndex:P,children:t.jsxs(i,{accessibilityLabel:M[y].shareCategory,heading:M[y].shareCategory,onDismiss:a,footer:t.jsx(c,{display:"flex",justifyContent:"end",padding:2,children:t.jsx(l,{text:M[y].close,onClick:a})}),size:"md",children:[t.jsx(n,{activeTabIndex:"share"===w?0:1,onChange:({activeTabIndex:e})=>{k(0===e?"share":"list")},tabs:[{text:M[y].shareWithUser,id:"share"},{text:M[y].sharing,id:"list"}]}),"share"===w?t.jsxs(c,{padding:4,children:[t.jsx(c,{marginBottom:4,children:t.jsx(d,{id:"categoryToShare",label:M[y].taskCategory,onChange:({value:e})=>C(e),placeholder:M[y].taskCategory,value:x,disabled:v,children:s.map((e=>t.jsx(d.Option,{label:M[y].categories[e]||e,value:e},e)))})}),t.jsx(c,{marginBottom:4,children:t.jsx(u,{id:"targetEmail",onChange:({value:e})=>b(e),placeholder:M[y].emailPlaceholder,label:M[y].shareWith,value:S,type:"email",disabled:v})}),t.jsx(l,{text:M[y].shareCategory,color:"blue",onClick:U,disabled:!x||!S||v})]}):t.jsxs(c,{padding:4,marginTop:2,children:[t.jsx(g,{weight:"bold",children:M[y].sharedByMe}),0===E.length?t.jsx(c,{padding:2,children:t.jsx(g,{children:M[y].noCustomCategories})}):E.map((e=>t.jsxs(h,{alignItems:"center",justifyContent:"between",gap:2,children:[t.jsxs(c,{flex:"grow",children:[t.jsx(g,{weight:"bold",children:M[y].categories[e.categoryName]||e.categoryName}),t.jsx(g,{size:"100",children:e.targetEmail})]}),t.jsx(l,{text:M[y].removeShare,onClick:()=>(async e=>{T(!0);try{await j(e),O()}catch(t){}finally{T(!1)}})(e.id),color:"red",size:"sm",disabled:v})]},e.id))),t.jsxs(c,{marginTop:4,children:[t.jsx(g,{weight:"bold",children:M[y].sharedWithMe}),0===R.length?t.jsx(c,{padding:2,children:t.jsx(g,{children:M[y].noCustomCategories})}):R.map((e=>t.jsxs(h,{alignItems:"center",gap:2,children:[t.jsx(m,{icon:"person",accessibilityLabel:"User",color:"darkGray"}),t.jsxs(c,{children:[t.jsx(g,{weight:"bold",children:M[y].categories[e.categoryName]||e.categoryName}),t.jsx(g,{size:"100",children:e.targetEmail})]})]},e.id)))]})]})]})}):null}function G(){const[e,o]=r.useState(U.get("theme","lightWash")),[i,n]=r.useState(U.get("language","pt")),[l,d]=r.useState(!1),[u,g]=r.useState(""),[m,j]=r.useState(U.getCustomCategories()),[P,q]=r.useState([]),[A,z]=r.useState(null),[G,$]=r.useState(""),[F,K]=r.useState("all"),[Y,H]=r.useState(U.get("groupBy","none")),[J,Q]=r.useState(!0),[V,X]=r.useState([]),[Z,_]=r.useState(!1),[ee,te]=r.useState(null),[ae,se]=r.useState(!1),[re,oe]=r.useState(!1),ie=new b,ne=W();r.useEffect((()=>{ee&&I.updatePreference(ee.uid,"theme",e),U.set("theme",e)}),[e,ee]),r.useEffect((()=>{ee&&I.updatePreference(ee.uid,"language",i),U.set("language",i)}),[i,ee]),r.useEffect((()=>{ee&&I.updatePreference(ee.uid,"groupBy",Y),U.set("groupBy",Y)}),[Y,ee]),r.useEffect((()=>{if(!ee){const e=U.get("tasks",[]);q(e)}}),[]),r.useEffect((()=>{const e=w(R,(async e=>{if(te(e),e){Q(!0);try{const t=await B.syncTasks(e.uid);q(t),U.set("tasks",t);const a=await I.getUserPreferences(e.uid);a&&(a.theme&&o(a.theme),a.language&&n(a.language),a.groupBy&&H(a.groupBy));const s=await O.getUserCategories(e.uid);s&&s.length>0&&(j(s),U.set("customCategories",s)),ce(M[i].syncSuccess)}catch(t){ce("Error syncing data")}finally{Q(!1)}}}));return()=>e()}),[]),r.useEffect((()=>{ee||U.set("tasks",P)}),[P,ee]);const ce=e=>{g(e),d(!0),setTimeout((()=>d(!1)),3e3)},le=async()=>{try{await T(R),te(null);const e=U.get("tasks",[]);q(e)}catch(e){ce(M[i].signOutError)}},de=P.filter((e=>{const t=e.text.toLowerCase().includes(G.toLowerCase());return"completed"===F?t&&e.completed:"pending"===F?t&&!e.completed:t}));return t.jsx(y,{deviceType:ne?"mobile":"desktop",children:t.jsx(f,{colorScheme:e,children:t.jsxs(c,{as:"main",margin:"auto",padding:4,height:"100svh",width:"100%",color:"lightWash"===e?"lightWash":"dark",rounding:0,justifyContent:"center",display:"block",children:[t.jsx(x,{theme:e,language:i,isMobile:ne,user:ee,toggleTheme:()=>{o("lightWash"===e?"dark":"lightWash")},setLanguage:e=>{n(e)},handleSignOut:le,setOpenLoginModal:se,syncData:async()=>{if(!ee)return ce(M[i].needLogin),void se(!0);Q(!0);try{const t=await B.syncTasks(ee.uid);q(t),U.set("tasks",t),await I.saveUserPreferences(ee.uid,{theme:e,language:i,groupBy:Y}),await O.saveCategories(ee.uid,m),ce(M[i].syncSuccess)}catch(t){ce(M[i].syncError)}finally{Q(!1)}},onOpenShareModal:oe}),t.jsx(E,{isOpen:ae,onClose:()=>se(!1),onLoginEmail:async(e,t)=>{try{const a=await k(R,e,t);te(a.user),se(!1),await I.ensureUserEmail(a.user.reloadUserInfo.localId)}catch(a){ce(`${M[i].loginEmailError}: ${a.message}`)}},onLoginGoogle:async()=>{try{const e=await v(R,ie);te(e.user),se(!1),await I.ensureUserEmail(e.user.reloadUserInfo.localId)}catch(e){ce(`${M[i].loginGoogleError}: ${e.message}`)}},onSignOut:le,user:ee,language:i}),t.jsx(D,{isOpen:re,onClose:()=>oe(!1),categories:[...Object.keys(M[i].categories),...m],language:i,user:ee,onShareCategory:async(e,t)=>{if(ee)try{const a=await L.shareCategory(e,ee.uid,t);return ce(M[i].shareCategorySuccess),a}catch(a){let e=M[i].shareCategoryError;throw"User not found"===a.message?e=M[i].userNotFound:"Cannot share with yourself"===a.message&&(e=M[i].cannotShareWithYourself),ce(e),a}else ce(M[i].needLogin)},onRemoveShare:async e=>{if(ee)try{await L.removeShare(e),ce(M[i].removeShareSuccess)}catch(t){throw ce(M[i].removeShareError),t}else ce(M[i].needLogin)}}),t.jsx(C,{id:"forms-accordion",accessibilityExpandLabel:"Expandir seção",accessibilityCollapseLabel:"Recolher seção",defaultExpandedIndices:[0,1],items:[{icon:"edit",children:t.jsx(a,{onAddTask:async(e,t)=>{if(A){const s={...A,text:e,category:t};_(!0);try{ee&&s.firebaseId&&await B.updateTask(s,ee.uid),q((e=>e.map((e=>e.id===s.id?s:e)))),z(null)}catch(a){ce(M[i].updateTaskError)}finally{_(!1)}}else{const s={id:Date.now().toString(),text:e,category:t,completed:!1};_(!0);try{if(ee){const e=await B.addTask(s,ee.uid);q((t=>[...t,e]))}else q((e=>[...e,s]))}catch(a){ce(M[i].addTaskError)}finally{_(!1)}}},language:i,isMobile:ne,disabled:J||Z,customCategories:m,onAddCategory:async e=>{try{if(ee){const t=await O.addCustomCategory(ee.uid,e);j(t),U.set("customCategories",t)}else{const t=U.addCustomCategory(e);j(t)}ce(M[i].categoryAdded)}catch(t){ce(M[i].error)}},onRemoveCategory:async e=>{try{if(P.some((t=>t.category===e)))return void ce(M[i].categoryInUse);if(ee){const t=await O.removeCustomCategory(ee.uid,e);j(t),U.set("customCategories",t)}else{const t=U.removeCustomCategory(e);j(t)}ce(M[i].categoryDeleted)}catch(t){ce(M[i].error)}},user:ee,isAddingTask:Z,editingTask:A,onCancelEdit:()=>z(null)}),title:M[i].addTaskPlaceholder},{icon:"filter",children:t.jsx(s,{searchTerm:G,filterStatus:F,groupBy:Y,onSearchChange:$,onFilterChange:K,onGroupByChange:H,language:i,isMobile:ne,disabled:J}),title:M[i].filterPlaceholder}]}),J?t.jsx(h,{alignItems:"center",flex:"grow",justifyContent:"center",children:t.jsx(c,{height:"100vh",marginTop:12,children:t.jsx(p,{show:!0,accessibilityLabel:M[i].loadingTasks})})}):t.jsx(N,{tasks:de,onToggleTask:async e=>{try{const t=P.find((t=>t.id===e));if(!t)return;X((t=>[...t,e]));const a={...t,completed:!t.completed};ee&&a.firebaseId&&await B.updateTask(a,ee.uid);const s=P.map((t=>t.id===e?a:t));q(s)}catch(t){ce(M[i].updateTaskError)}finally{X((t=>t.filter((t=>t!==e))))}},onClearCompleted:async()=>{try{const e=P.filter((e=>e.completed)),t=e.map((e=>e.id)),a=P.filter((e=>!e.completed));if(X((e=>[...e,...t])),ee)for(const s of e)s.firebaseId&&await B.deleteTask(s.firebaseId);q(a),ce(M[i].clearCompletedSuccess)}catch(e){ce(M[i].clearCompletedError)}finally{X([])}},filterStatus:F,groupBy:Y,language:i,isMobile:ne,loadingTaskIds:V,onEditTask:z}),t.jsx(S,{show:l,message:u,onDismiss:()=>d(!1),language:i})]})})})}function $(){return t.jsx(G,{})}D.propTypes={isOpen:e.bool.isRequired,onClose:e.func.isRequired,categories:e.array.isRequired,language:e.string.isRequired,user:e.object,onShareCategory:e.func.isRequired,onRemoveShare:e.func.isRequired};const F=document.getElementById("root");F&&z.createRoot(F).render(t.jsx(r.StrictMode,{children:t.jsx($,{})}));
