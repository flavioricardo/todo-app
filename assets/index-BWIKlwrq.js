const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ShareCategory-ZafwDYLt.js","assets/ui-components-form-Dywr9yTf.js","assets/vendor-gestalt-B3UPgpSj.js","assets/vendor-react-BCfQGrxo.js","assets/app-constants-wElj3pIu.js","assets/vendor-prop-types-CZV6H2So.js","assets/app-utils-CDJKhibu.js","assets/app-services-B92wDHXI.js","assets/vendor-firebase-BBMrpKQ9.js","assets/ui-components-task-Dzkb064a.js"])))=>i.map(i=>d[i]);
import{_ as e,j as t}from"./ui-components-form-Dywr9yTf.js";import{r as s,l as a,m as o,B as r,a as n,d as i}from"./vendor-gestalt-B3UPgpSj.js";import{a as c}from"./vendor-react-BCfQGrxo.js";import{G as l,o as u,m as d,n as g,p as m}from"./vendor-firebase-BBMrpKQ9.js";import{A as f,a as y,T as h}from"./ui-components-core-k9eWupOI.js";import{L as p}from"./ui-components-auth-iEDtWuOU.js";import{t as C}from"./app-constants-wElj3pIu.js";import{u as S,a as j,t as E,c as k,s as w}from"./app-services-B92wDHXI.js";import{s as T,u as b}from"./app-utils-CDJKhibu.js";import"./vendor-prop-types-CZV6H2So.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var x,v={},L=function(){if(x)return v;x=1;var e=c();return v.createRoot=e.createRoot,v.hydrateRoot=e.hydrateRoot,v}();const _=s.lazy((()=>e((()=>import("./ShareCategory-ZafwDYLt.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8])))),I=s.lazy((()=>e((()=>import("./ui-components-form-Dywr9yTf.js").then((e=>e.T))),__vite__mapDeps([1,2,3,4,5,6])))),O=s.lazy((()=>e((()=>import("./ui-components-form-Dywr9yTf.js").then((e=>e.a))),__vite__mapDeps([1,2,3,4,5,6])))),P=s.lazy((()=>e((()=>import("./ui-components-task-Dzkb064a.js")),__vite__mapDeps([9,1,2,3,4,5,6,7,8]))));function R(){const[e,c]=s.useState(T.get("theme","lightWash")),[x,v]=s.useState(T.get("language","pt")),[L,R]=s.useState(!1),[B,A]=s.useState(""),[U,D]=s.useState(T.getCustomCategories()),[M,W]=s.useState([]),[z,G]=s.useState(null),[N,V]=s.useState(""),[$,F]=s.useState("all"),[q,K]=s.useState(T.get("groupBy","none")),[Y,H]=s.useState(!0),[J,Q]=s.useState([]),[X,Z]=s.useState(!1),[ee,te]=s.useState(null),[se,ae]=s.useState(!1),[oe,re]=s.useState(!1),ne=new l,ie=b();s.useEffect((()=>{ee&&S.updatePreference(ee.uid,"theme",e),T.set("theme",e)}),[e,ee]),s.useEffect((()=>{ee&&S.updatePreference(ee.uid,"language",x),T.set("language",x)}),[x,ee]),s.useEffect((()=>{ee&&S.updatePreference(ee.uid,"groupBy",q),T.set("groupBy",q)}),[q,ee]),s.useEffect((()=>{if(!ee){const e=T.get("tasks",[]);W(e)}}),[]),s.useEffect((()=>{const e=u(j,(async e=>{if(te(e),e){H(!0);try{const t=await E.syncTasks(e.uid);W(t),T.set("tasks",t);const s=await S.getUserPreferences(e.uid);s&&(s.theme&&c(s.theme),s.language&&v(s.language),s.groupBy&&K(s.groupBy));const a=await k.getUserCategories(e.uid);a&&a.length>0&&(D(a),T.set("customCategories",a)),ce(C[x].syncSuccess)}catch(t){ce("Error syncing data")}finally{H(!1)}}}));return()=>e()}),[]),s.useEffect((()=>{ee||T.set("tasks",M)}),[M,ee]);const ce=e=>{A(e),R(!0),setTimeout((()=>R(!1)),3e3)},le=async()=>{try{await m(j),te(null);const e=T.get("tasks",[]);W(e)}catch(e){ce(C[x].signOutError)}},ue=M.filter((e=>{const t=e.text.toLowerCase().includes(N.toLowerCase());return"completed"===$?t&&e.completed:"pending"===$?t&&!e.completed:t}));return t.jsx(a,{deviceType:ie?"mobile":"desktop",children:t.jsx(o,{colorScheme:e,children:t.jsxs(r,{as:"main",margin:"auto",padding:4,height:"100svh",width:"100%",color:"lightWash"===e?"lightWash":"dark",rounding:0,justifyContent:"center",display:"block",children:[t.jsx(f,{theme:e,language:x,isMobile:ie,user:ee,toggleTheme:()=>{c("lightWash"===e?"dark":"lightWash")},setLanguage:e=>{v(e)},handleSignOut:le,setOpenLoginModal:ae,syncData:async()=>{if(!ee)return ce(C[x].needLogin),void ae(!0);H(!0);try{const t=await E.syncTasks(ee.uid);W(t),T.set("tasks",t),await S.saveUserPreferences(ee.uid,{theme:e,language:x,groupBy:q}),await k.saveCategories(ee.uid,U),ce(C[x].syncSuccess)}catch(t){ce(C[x].syncError)}finally{H(!1)}},onOpenShareModal:re}),t.jsx(p,{isOpen:se,onClose:()=>ae(!1),onLoginEmail:async(e,t)=>{try{const s=await d(j,e,t);te(s.user),ae(!1),await S.ensureUserEmail(s.user.reloadUserInfo.localId)}catch(s){ce(`${C[x].loginEmailError}: ${s.message}`)}},onLoginGoogle:async()=>{try{const e=await g(j,ne);te(e.user),ae(!1),await S.ensureUserEmail(e.user.reloadUserInfo.localId)}catch(e){ce(`${C[x].loginGoogleError}: ${e.message}`)}},onSignOut:le,user:ee,language:x}),t.jsxs(s.Suspense,{fallback:t.jsx(i,{show:!0,accessibilityLabel:"Loading..."}),children:[t.jsx(_,{isOpen:oe,onClose:()=>re(!1),categories:[...Object.keys(C[x].categories),...U],language:x,user:ee,onShareCategory:async(e,t)=>{if(ee)try{const s=await w.shareCategory(e,ee.uid,t);return ce(C[x].shareCategorySuccess),s}catch(s){let e=C[x].shareCategoryError;throw"User not found"===s.message?e=C[x].userNotFound:"Cannot share with yourself"===s.message&&(e=C[x].cannotShareWithYourself),ce(e),s}else ce(C[x].needLogin)},onRemoveShare:async e=>{if(ee)try{await w.removeShare(e),ce(C[x].removeShareSuccess)}catch(t){throw ce(C[x].removeShareError),t}else ce(C[x].needLogin)}}),t.jsx(y,{id:"forms-accordion",accessibilityExpandLabel:"Expandir seção",accessibilityCollapseLabel:"Recolher seção",defaultExpandedIndices:[0,1],items:[{icon:"edit",children:t.jsx(O,{onAddTask:async(e,t)=>{if(z){const a={...z,text:e,category:t};Z(!0);try{ee&&a.firebaseId&&await E.updateTask(a,ee.uid),W((e=>e.map((e=>e.id===a.id?a:e)))),G(null)}catch(s){ce(C[x].updateTaskError)}finally{Z(!1)}}else{const a={id:Date.now().toString(),text:e,category:t,completed:!1};Z(!0);try{if(ee){const e=await E.addTask(a,ee.uid);W((t=>[...t,e]))}else W((e=>[...e,a]))}catch(s){ce(C[x].addTaskError)}finally{Z(!1)}}},language:x,isMobile:ie,disabled:Y||X,customCategories:U,onAddCategory:async e=>{try{if(ee){const t=await k.addCustomCategory(ee.uid,e);D(t),T.set("customCategories",t)}else{const t=T.addCustomCategory(e);D(t)}ce(C[x].categoryAdded)}catch(t){ce(C[x].error)}},onRemoveCategory:async e=>{try{if(M.some((t=>t.category===e)))return void ce(C[x].categoryInUse);if(ee){const t=await k.removeCustomCategory(ee.uid,e);D(t),T.set("customCategories",t)}else{const t=T.removeCustomCategory(e);D(t)}ce(C[x].categoryDeleted)}catch(t){ce(C[x].error)}},user:ee,isAddingTask:X,editingTask:z,onCancelEdit:()=>G(null)}),title:C[x].addTaskPlaceholder},{icon:"filter",children:t.jsx(I,{searchTerm:N,filterStatus:$,groupBy:q,onSearchChange:V,onFilterChange:F,onGroupByChange:K,language:x,isMobile:ie,disabled:Y}),title:C[x].filterPlaceholder}]}),Y?t.jsx(n,{alignItems:"center",flex:"grow",justifyContent:"center",children:t.jsx(r,{height:"100vh",marginTop:12,children:t.jsx(i,{show:!0,accessibilityLabel:C[x].loadingTasks})})}):t.jsx(P,{tasks:ue,onToggleTask:async e=>{try{const t=M.find((t=>t.id===e));if(!t)return;Q((t=>[...t,e]));const s={...t,completed:!t.completed};ee&&s.firebaseId&&await E.updateTask(s,ee.uid);const a=M.map((t=>t.id===e?s:t));W(a)}catch(t){ce(C[x].updateTaskError)}finally{Q((t=>t.filter((t=>t!==e))))}},onClearCompleted:async()=>{try{const e=M.filter((e=>e.completed)),t=e.map((e=>e.id)),s=M.filter((e=>!e.completed));if(Q((e=>[...e,...t])),ee)for(const a of e)a.firebaseId&&await E.deleteTask(a.firebaseId);W(s),ce(C[x].clearCompletedSuccess)}catch(e){ce(C[x].clearCompletedError)}finally{Q([])}},filterStatus:$,groupBy:q,language:x,isMobile:ie,loadingTaskIds:J,onEditTask:G}),t.jsx(h,{show:L,message:B,onDismiss:()=>R(!1),language:x})]})]})})})}function B(){return t.jsx(R,{})}const A=document.getElementById("root");A&&L.createRoot(A).render(t.jsx(s.StrictMode,{children:t.jsx(B,{})}));
