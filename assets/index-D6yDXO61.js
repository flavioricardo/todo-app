import{j as e,T as t,a as s,t as a,b as r}from"./components-small-DujY9M-8.js";import{r as n,j as o,C as i,k as c,l,B as u,F as d,m as g}from"./vendor-gestalt-Dy55GaTK.js";import{a as f}from"./vendor-react-BtDQ8f-S.js";import{d as m,k as p,s as h,l as y,G as j,o as k,m as w,n as S,p as x}from"./vendor-firebase-G-DTV4qV.js";import{A as b}from"./component-header-1UZazDdU.js";import{L as E}from"./component-login-D10Zhrol.js";import{T}from"./component-tasklist-l64hMK_C.js";import{d as v,a as C,t as L}from"./services-Cg9QUexp.js";import{s as B,u as P}from"./utils-ClhkrWZR.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var O,I={};var M=function(){if(O)return I;O=1;var e=f();return I.createRoot=e.createRoot,I.hydrateRoot=e.hydrateRoot,I}();const W="users",A={async getUserPreferences(e){try{const t=m(v,W,e),s=await y(t);return s.exists()?s.data():{theme:B.get("theme","lightWash"),language:B.get("language","pt")}}catch(t){throw t}},async saveUserPreferences(e,t){try{const s=m(v,W,e);return await p(s,{...t,updatedAt:h()},{merge:!0}),t}catch(s){throw s}},async updatePreference(e,t,s){try{const a=m(v,W,e);return await p(a,{[t]:s,updatedAt:h()},{merge:!0}),{[t]:s}}catch(a){throw a}}};function R(){const[f,m]=n.useState(B.get("theme","lightWash")),[p,h]=n.useState(B.get("language","pt")),[y,v]=n.useState(!1),[O,I]=n.useState(""),[M,W]=n.useState([]),[R,G]=n.useState(""),[U,$]=n.useState("all"),[D,N]=n.useState(B.get("groupBy","none")),[F,q]=n.useState(!1),[z,K]=n.useState(null),[H,J]=n.useState(!1),Q=new j,V=P(),X=new o(10),Y=new i([X]);n.useEffect((()=>{z&&A.updatePreference(z.uid,"theme",f),B.set("theme",f)}),[f,z]),n.useEffect((()=>{z&&A.updatePreference(z.uid,"language",p),B.set("language",p)}),[p,z]),n.useEffect((()=>{z&&A.updatePreference(z.uid,"groupBy",D),B.set("groupBy",D)}),[D,z]),n.useEffect((()=>{if(!z){const e=B.get("tasks",[]);W(e)}}),[]),n.useEffect((()=>{const e=k(C,(async e=>{if(K(e),e){q(!0);try{const t=await L.syncTasks(e.uid);W(t),B.set("tasks",t);const s=await A.getUserPreferences(e.uid);s&&(s.theme&&m(s.theme),s.language&&h(s.language),s.groupBy&&N(s.groupBy)),Z("Tasks and preferences synced successfully!")}catch(t){Z("Error syncing data")}finally{q(!1)}}}));return()=>e()}),[]),n.useEffect((()=>{z||B.set("tasks",M)}),[M,z]);const Z=e=>{I(e),v(!0),setTimeout((()=>v(!1)),3e3)},_=async()=>{try{await x(C),K(null);const e=B.get("tasks",[]);W(e)}catch(e){Z(a[p].signOutError)}},ee=M.filter((e=>{const t=e.text.toLowerCase().includes(R.toLowerCase());return"completed"===U?t&&e.completed:"pending"===U?t&&!e.completed:t}));return e.jsx(c,{deviceType:V?"mobile":"desktop",children:e.jsx(l,{colorScheme:f,children:e.jsxs(u,{as:"main",margin:"auto",padding:4,width:"100%",color:"lightWash"===f?"lightWash":"dark",rounding:0,justifyContent:"center",display:"block",height:"100vh",children:[e.jsx(b,{theme:f,language:p,isMobile:V,user:z,toggleTheme:()=>{m("lightWash"===f?"dark":"lightWash")},setLanguage:e=>{h(e)},handleSignOut:_,setOpenLoginModal:J,syncData:async()=>{if(!z)return Z(a[p].needLogin),void J(!0);q(!0);try{const e=await L.syncTasks(z.uid);W(e),B.set("tasks",e),await A.saveUserPreferences(z.uid,{theme:f,language:p,groupBy:D}),Z(a[p].syncSuccess)}catch(e){Z(a[p].syncError)}finally{q(!1)}}}),e.jsx(E,{isOpen:H,onClose:()=>J(!1),onLoginEmail:async(e,t)=>{try{const s=await w(C,e,t);K(s.user),J(!1)}catch(s){Z(`${a[p].loginEmailError}: ${s.message}`)}},onLoginGoogle:async()=>{try{const e=await S(C,Q);K(e.user),J(!1)}catch(e){Z(`${a[p].loginGoogleError}: ${e.message}`)}},onSignOut:_,user:z,language:p,zIndex:Y}),e.jsx(t,{onAddTask:async(e,t)=>{const s={id:Date.now().toString(),text:e,category:t,completed:!1};q(!0);try{if(z){q(!0);const e=await L.addTask(s,z.uid);W((t=>[...t,e]))}else W((e=>[...e,s]))}catch(r){Z(a[p].addTaskError)}finally{q(!1)}},language:p,isMobile:V,disabled:F}),e.jsx(s,{searchTerm:R,filterStatus:U,groupBy:D,onSearchChange:G,onFilterChange:$,onGroupByChange:N,language:p,isMobile:V,disabled:F}),F?e.jsx(d,{alignItems:"center",justifyContent:"center",height:"200px",children:e.jsx(g,{show:!0,accessibilityLabel:a[p].loadingTasks})}):e.jsx(T,{tasks:ee,onToggleTask:async e=>{try{const t=M.find((t=>t.id===e));if(!t)return;const s={...t,completed:!t.completed};z&&s.firebaseId&&(q(!0),await L.updateTask(s,z.uid));const a=M.map((t=>t.id===e?s:t));W(a)}catch(t){Z(a[p].updateTaskError)}finally{q(!1)}},onClearCompleted:async()=>{try{const e=M.filter((e=>e.completed)),t=M.filter((e=>!e.completed));if(z){q(!0);for(const t of e)t.firebaseId&&await L.deleteTask(t.firebaseId)}W(t),Z(a[p].clearCompletedSuccess)}catch(e){Z(a[p].clearCompletedError)}finally{q(!1)}},filterStatus:U,groupBy:D,language:p,isMobile:V}),e.jsx(r,{show:y,message:O,onDismiss:()=>v(!1),language:p})]})})})}function G(){return e.jsx(R,{})}const U=document.getElementById("root");U&&M.createRoot(U).render(e.jsx(n.StrictMode,{children:e.jsx(G,{})}));
