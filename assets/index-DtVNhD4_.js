const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ShareCategory-D0aZTFQB.js","assets/ui-components-form-BdAKQOd-.js","assets/vendor-gestalt-D77DYD9B.js","assets/vendor-react-CZcdZKLu.js","assets/app-constants-wElj3pIu.js","assets/vendor-prop-types-CXM-vOnM.js","assets/app-utils-BsapvAQg.js","assets/app-services-I9EbIFBO.js","assets/vendor-firebase-D18ONwfu.js","assets/ui-components-task-BrNxk3CY.js"])))=>i.map(i=>d[i]);
import{_ as t,j as a}from"./ui-components-form-BdAKQOd-.js";import{r as e,l as o,m as s,B as n,a as i,d as r}from"./vendor-gestalt-D77DYD9B.js";import{a as c}from"./vendor-react-CZcdZKLu.js";import{G as l,o as u,m as d,n as g,p as m}from"./vendor-firebase-D18ONwfu.js";import{A as h,a as f,T as p}from"./ui-components-core-0B9tf6fX.js";import{L as y}from"./ui-components-auth-Bekbvgkt.js";import{t as w}from"./app-constants-wElj3pIu.js";import{u as b,a as _,t as k,c as C,s as j}from"./app-services-I9EbIFBO.js";import{s as L,u as T}from"./app-utils-BsapvAQg.js";import"./vendor-prop-types-CXM-vOnM.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver((t=>{for(const e of t)if("childList"===e.type)for(const t of e.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&a(t)})).observe(document,{childList:!0,subtree:!0})}function a(t){if(t.ep)return;t.ep=!0;const a=function(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?a.credentials="include":"anonymous"===t.crossOrigin?a.credentials="omit":a.credentials="same-origin",a}(t);fetch(t.href,a)}}();var v,E={},O=function(){if(v)return E;v=1;var t=c();return E.createRoot=t.createRoot,E.hydrateRoot=t.hydrateRoot,E}();const S=e.lazy((()=>t((()=>import("./ShareCategory-D0aZTFQB.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8])))),A=e.lazy((()=>t((()=>import("./ui-components-form-BdAKQOd-.js").then((t=>t.T))),__vite__mapDeps([1,2,3,4,5,6])))),B=e.lazy((()=>t((()=>import("./ui-components-form-BdAKQOd-.js").then((t=>t.a))),__vite__mapDeps([1,2,3,4,5,6])))),I=e.lazy((()=>t((()=>import("./ui-components-task-BrNxk3CY.js")),__vite__mapDeps([9,1,2,3,4,5,6,7,8]))));function D(){const[t,c]=e.useState(L.get("theme","lightWash")),[v,E]=e.useState(L.get("language","pt")),[O,D]=e.useState(!1),[M,R]=e.useState(""),[x,W]=e.useState(L.getCustomCategories()),[P,V]=e.useState([]),[$,G]=e.useState(null),[F,K]=e.useState(""),[N,U]=e.useState("all"),[q,z]=e.useState(L.get("groupBy","none")),[H,J]=e.useState(!0),[Q,X]=e.useState([]),[Y,Z]=e.useState(!1),[tt,at]=e.useState(null),[et,ot]=e.useState(!1),[st,nt]=e.useState(!1),it=new l,rt=T();e.useEffect((()=>{tt&&b.updatePreference(tt.uid,"theme",t),L.set("theme",t)}),[t,tt]),e.useEffect((()=>{tt&&b.updatePreference(tt.uid,"language",v),L.set("language",v)}),[v,tt]),e.useEffect((()=>{tt&&b.updatePreference(tt.uid,"groupBy",q),L.set("groupBy",q)}),[q,tt]),e.useEffect((()=>{if(!tt){const t=L.get("tasks",[]);V(t)}}),[]),e.useEffect((()=>{const t=u(_,(async t=>{if(at(t),t){J(!0);try{const a=await k.syncTasks(t.uid);V(a),L.set("tasks",a);const e=await b.getUserPreferences(t.uid);e&&(e.theme&&c(e.theme),e.language&&E(e.language),e.groupBy&&z(e.groupBy));const o=await C.getUserCategories(t.uid);o&&o.length>0&&(W(o),L.set("customCategories",o)),ct(w[v].syncSuccess)}catch(a){ct("Error syncing data")}finally{J(!1)}}}));return()=>t()}),[]),e.useEffect((()=>{tt||L.set("tasks",P)}),[P,tt]);const ct=t=>{R(t),D(!0),setTimeout((()=>D(!1)),3e3)},lt=async()=>{try{await m(_),at(null);const t=L.get("tasks",[]);V(t)}catch(t){ct(w[v].signOutError)}},ut=P.filter((t=>{const a=t.text.toLowerCase().includes(F.toLowerCase());return"completed"===N?a&&t.completed:"pending"===N?a&&!t.completed:a}));return a.jsx(o,{deviceType:rt?"mobile":"desktop",children:a.jsx(s,{colorScheme:t,children:a.jsxs(n,{as:"main",margin:"auto",padding:4,height:"100svh",width:"100%",color:"lightWash"===t?"lightWash":"dark",rounding:0,justifyContent:"center",display:"block",children:[a.jsx(h,{theme:t,language:v,isMobile:rt,user:tt,toggleTheme:()=>{c("lightWash"===t?"dark":"lightWash")},setLanguage:t=>{E(t)},handleSignOut:lt,setOpenLoginModal:ot,syncData:async()=>{if(!tt)return ct(w[v].needLogin),void ot(!0);J(!0);try{const a=await k.syncTasks(tt.uid);V(a),L.set("tasks",a),await b.saveUserPreferences(tt.uid,{theme:t,language:v,groupBy:q}),await C.saveCategories(tt.uid,x),ct(w[v].syncSuccess)}catch(a){ct(w[v].syncError)}finally{J(!1)}},onOpenShareModal:nt}),a.jsx(y,{isOpen:et,onClose:()=>ot(!1),onLoginEmail:async(t,a)=>{try{const e=await d(_,t,a);at(e.user),ot(!1),await b.ensureUserEmail(e.user.reloadUserInfo.localId)}catch(e){ct(`${w[v].loginEmailError}: ${e.message}`)}},onLoginGoogle:async()=>{try{const t=await g(_,it);at(t.user),ot(!1),await b.ensureUserEmail(t.user.reloadUserInfo.localId)}catch(t){ct(`${w[v].loginGoogleError}: ${t.message}`)}},onSignOut:lt,user:tt,language:v}),a.jsxs(e.Suspense,{fallback:a.jsx(r,{show:!0,accessibilityLabel:"Loading..."}),children:[a.jsx(S,{isOpen:st,onClose:()=>nt(!1),categories:[...Object.keys(w[v].categories),...x],language:v,user:tt,onShareCategory:async(t,a)=>{if(tt)try{const e=await j.shareCategory(t,tt.uid,a);return ct(w[v].shareCategorySuccess),e}catch(e){let t=w[v].shareCategoryError;throw"User not found"===e.message?t=w[v].userNotFound:"Cannot share with yourself"===e.message&&(t=w[v].cannotShareWithYourself),ct(t),e}else ct(w[v].needLogin)},onRemoveShare:async t=>{if(tt)try{await j.removeShare(t),ct(w[v].removeShareSuccess)}catch(a){throw ct(w[v].removeShareError),a}else ct(w[v].needLogin)}}),a.jsx(f,{id:"forms-accordion",accessibilityExpandLabel:"Expandir seção",accessibilityCollapseLabel:"Recolher seção",defaultExpandedIndices:[0,1],items:[{icon:"edit",children:a.jsx(B,{onAddTask:async(t,a)=>{if($){const o={...$,text:t,category:a};Z(!0);try{tt&&o.firebaseId&&await k.updateTask(o,tt.uid),V((t=>t.map((t=>t.id===o.id?o:t)))),G(null)}catch(e){ct(w[v].updateTaskError)}finally{Z(!1)}}else{const o={id:Date.now().toString(),text:t,category:a,completed:!1};Z(!0);try{if(tt){const t=await k.addTask(o,tt.uid);V((a=>[...a,t]))}else V((t=>[...t,o]))}catch(e){ct(w[v].addTaskError)}finally{Z(!1)}}},language:v,isMobile:rt,disabled:H||Y,customCategories:x,onAddCategory:async t=>{try{if(tt){const a=await C.addCustomCategory(tt.uid,t);W(a),L.set("customCategories",a)}else{const a=L.addCustomCategory(t);W(a)}ct(w[v].categoryAdded)}catch(a){ct(w[v].error)}},onRemoveCategory:async t=>{try{if(P.some((a=>a.category===t)))return void ct(w[v].categoryInUse);if(tt){const a=await C.removeCustomCategory(tt.uid,t);W(a),L.set("customCategories",a)}else{const a=L.removeCustomCategory(t);W(a)}ct(w[v].categoryDeleted)}catch(a){ct(w[v].error)}},user:tt,isAddingTask:Y,editingTask:$,onCancelEdit:()=>G(null)}),title:w[v].addTaskPlaceholder},{icon:"filter",children:a.jsx(A,{searchTerm:F,filterStatus:N,groupBy:q,onSearchChange:K,onFilterChange:U,onGroupByChange:z,language:v,isMobile:rt,disabled:H}),title:w[v].filterPlaceholder}]}),H?a.jsx(i,{alignItems:"center",flex:"grow",justifyContent:"center",children:a.jsx(n,{height:"100vh",marginTop:12,children:a.jsx(r,{show:!0,accessibilityLabel:w[v].loadingTasks})})}):a.jsx(I,{tasks:ut,onToggleTask:async t=>{try{const a=P.find((a=>a.id===t));if(!a)return;X((a=>[...a,t]));const e={...a,completed:!a.completed};tt&&e.firebaseId&&await k.updateTask(e,tt.uid);const o=P.map((a=>a.id===t?e:a));V(o)}catch(a){ct(w[v].updateTaskError)}finally{X((a=>a.filter((a=>a!==t))))}},onClearCompleted:async()=>{try{const t=P.filter((t=>t.completed)),a=t.map((t=>t.id)),e=P.filter((t=>!t.completed));if(X((t=>[...t,...a])),tt)for(const o of t)o.firebaseId&&await k.deleteTask(o.firebaseId);V(e),ct(w[v].clearCompletedSuccess)}catch(t){ct(w[v].clearCompletedError)}finally{X([])}},filterStatus:N,groupBy:q,language:v,isMobile:rt,loadingTaskIds:Q,onEditTask:G}),a.jsx(p,{show:O,message:M,onDismiss:()=>D(!1),language:v})]})]})})})}function M(){return a.jsx(D,{})}const R=document.getElementById("root");R&&O.createRoot(R).render(a.jsx(e.StrictMode,{children:a.jsx(M,{})}));
