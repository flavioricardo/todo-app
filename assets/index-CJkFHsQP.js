const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ShareCategory-Dn8Jii98.js","assets/ui-components-form-CWcqC4Wb.js","assets/vendor-RUKFzHni.js","assets/app-constants-wElj3pIu.js","assets/vendor-prop-types-CXM-vOnM.js","assets/app-utils-DBK4lIIs.js","assets/app-services-C_BzRTV2.js","assets/vendor-firebase-D18ONwfu.js","assets/ui-components-task-DvmqkoRA.js"])))=>i.map(i=>d[i]);
import{_ as t,j as a}from"./ui-components-form-CWcqC4Wb.js";import{n as e,r as o,o as n,p as s,B as i,b as r,e as c}from"./vendor-RUKFzHni.js";import{G as l,o as u,m as g,n as d,p as m}from"./vendor-firebase-D18ONwfu.js";import{A as h,a as f,T as p}from"./ui-components-core-Ba5vClvk.js";import{L as y}from"./ui-components-auth-DsfG0i12.js";import{t as w}from"./app-constants-wElj3pIu.js";import{u as b,a as _,t as k,c as C,s as j}from"./app-services-C_BzRTV2.js";import{s as L,u as T}from"./app-utils-DBK4lIIs.js";import"./vendor-prop-types-CXM-vOnM.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver((t=>{for(const e of t)if("childList"===e.type)for(const t of e.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&a(t)})).observe(document,{childList:!0,subtree:!0})}function a(t){if(t.ep)return;t.ep=!0;const a=function(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?a.credentials="include":"anonymous"===t.crossOrigin?a.credentials="omit":a.credentials="same-origin",a}(t);fetch(t.href,a)}}();var E,v={},O=function(){if(E)return v;E=1;var t=e();return v.createRoot=t.createRoot,v.hydrateRoot=t.hydrateRoot,v}();const S=o.lazy((()=>t((()=>import("./ShareCategory-Dn8Jii98.js")),__vite__mapDeps([0,1,2,3,4,5,6,7])))),A=o.lazy((()=>t((()=>import("./ui-components-form-CWcqC4Wb.js").then((t=>t.T))),__vite__mapDeps([1,2,3,4,5])))),B=o.lazy((()=>t((()=>import("./ui-components-form-CWcqC4Wb.js").then((t=>t.a))),__vite__mapDeps([1,2,3,4,5])))),I=o.lazy((()=>t((()=>import("./ui-components-task-DvmqkoRA.js")),__vite__mapDeps([8,1,2,3,4,5,6,7]))));function D(){const[t,e]=o.useState(L.get("theme","lightWash")),[E,v]=o.useState(L.get("language","pt")),[O,D]=o.useState(!1),[M,R]=o.useState(""),[x,W]=o.useState(L.getCustomCategories()),[P,V]=o.useState([]),[$,G]=o.useState(null),[F,K]=o.useState(""),[N,U]=o.useState("all"),[q,z]=o.useState(L.get("groupBy","none")),[H,J]=o.useState(!0),[Q,X]=o.useState([]),[Y,Z]=o.useState(!1),[tt,at]=o.useState(null),[et,ot]=o.useState(!1),[nt,st]=o.useState(!1),it=new l,rt=T();o.useEffect((()=>{tt&&b.updatePreference(tt.uid,"theme",t),L.set("theme",t)}),[t,tt]),o.useEffect((()=>{tt&&b.updatePreference(tt.uid,"language",E),L.set("language",E)}),[E,tt]),o.useEffect((()=>{tt&&b.updatePreference(tt.uid,"groupBy",q),L.set("groupBy",q)}),[q,tt]),o.useEffect((()=>{if(!tt){const t=L.get("tasks",[]);V(t)}}),[]),o.useEffect((()=>{const t=u(_,(async t=>{if(at(t),t){J(!0);try{const a=await k.syncTasks(t.uid);V(a),L.set("tasks",a);const o=await b.getUserPreferences(t.uid);o&&(o.theme&&e(o.theme),o.language&&v(o.language),o.groupBy&&z(o.groupBy));const n=await C.getUserCategories(t.uid);n&&n.length>0&&(W(n),L.set("customCategories",n)),ct(w[E].syncSuccess)}catch(a){ct("Error syncing data")}finally{J(!1)}}}));return()=>t()}),[]),o.useEffect((()=>{tt||L.set("tasks",P)}),[P,tt]);const ct=t=>{R(t),D(!0),setTimeout((()=>D(!1)),3e3)},lt=async()=>{try{await m(_),at(null);const t=L.get("tasks",[]);V(t)}catch(t){ct(w[E].signOutError)}},ut=P.filter((t=>{const a=t.text.toLowerCase().includes(F.toLowerCase());return"completed"===N?a&&t.completed:"pending"===N?a&&!t.completed:a}));return a.jsx(n,{deviceType:rt?"mobile":"desktop",children:a.jsx(s,{colorScheme:t,children:a.jsxs(i,{as:"main",margin:"auto",padding:4,height:"100svh",width:"100%",color:"lightWash"===t?"lightWash":"dark",rounding:0,justifyContent:"center",display:"block",children:[a.jsx(h,{theme:t,language:E,isMobile:rt,user:tt,toggleTheme:()=>{e("lightWash"===t?"dark":"lightWash")},setLanguage:t=>{v(t)},handleSignOut:lt,setOpenLoginModal:ot,syncData:async()=>{if(!tt)return ct(w[E].needLogin),void ot(!0);J(!0);try{const a=await k.syncTasks(tt.uid);V(a),L.set("tasks",a),await b.saveUserPreferences(tt.uid,{theme:t,language:E,groupBy:q}),await C.saveCategories(tt.uid,x),ct(w[E].syncSuccess)}catch(a){ct(w[E].syncError)}finally{J(!1)}},onOpenShareModal:st}),a.jsx(y,{isOpen:et,onClose:()=>ot(!1),onLoginEmail:async(t,a)=>{try{const e=await g(_,t,a);at(e.user),ot(!1),await b.ensureUserEmail(e.user.reloadUserInfo.localId)}catch(e){ct(`${w[E].loginEmailError}: ${e.message}`)}},onLoginGoogle:async()=>{try{const t=await d(_,it);at(t.user),ot(!1),await b.ensureUserEmail(t.user.reloadUserInfo.localId)}catch(t){ct(`${w[E].loginGoogleError}: ${t.message}`)}},onSignOut:lt,user:tt,language:E}),a.jsxs(o.Suspense,{fallback:a.jsx(c,{show:!0,accessibilityLabel:"Loading..."}),children:[a.jsx(S,{isOpen:nt,onClose:()=>st(!1),categories:[...Object.keys(w[E].categories),...x],language:E,user:tt,onShareCategory:async(t,a)=>{if(tt)try{const e=await j.shareCategory(t,tt.uid,a);return ct(w[E].shareCategorySuccess),e}catch(e){let t=w[E].shareCategoryError;throw"User not found"===e.message?t=w[E].userNotFound:"Cannot share with yourself"===e.message&&(t=w[E].cannotShareWithYourself),ct(t),e}else ct(w[E].needLogin)},onRemoveShare:async t=>{if(tt)try{await j.removeShare(t),ct(w[E].removeShareSuccess)}catch(a){throw ct(w[E].removeShareError),a}else ct(w[E].needLogin)}}),a.jsx(f,{id:"forms-accordion",accessibilityExpandLabel:"Expandir seção",accessibilityCollapseLabel:"Recolher seção",defaultExpandedIndices:[0,1],items:[{icon:"edit",children:a.jsx(B,{onAddTask:async(t,a)=>{if($){const o={...$,text:t,category:a};Z(!0);try{tt&&o.firebaseId&&await k.updateTask(o,tt.uid),V((t=>t.map((t=>t.id===o.id?o:t)))),G(null)}catch(e){ct(w[E].updateTaskError)}finally{Z(!1)}}else{const o={id:Date.now().toString(),text:t,category:a,completed:!1};Z(!0);try{if(tt){const t=await k.addTask(o,tt.uid);V((a=>[...a,t]))}else V((t=>[...t,o]))}catch(e){ct(w[E].addTaskError)}finally{Z(!1)}}},language:E,isMobile:rt,disabled:H||Y,customCategories:x,onAddCategory:async t=>{try{if(tt){const a=await C.addCustomCategory(tt.uid,t);W(a),L.set("customCategories",a)}else{const a=L.addCustomCategory(t);W(a)}ct(w[E].categoryAdded)}catch(a){ct(w[E].error)}},onRemoveCategory:async t=>{try{if(P.some((a=>a.category===t)))return void ct(w[E].categoryInUse);if(tt){const a=await C.removeCustomCategory(tt.uid,t);W(a),L.set("customCategories",a)}else{const a=L.removeCustomCategory(t);W(a)}ct(w[E].categoryDeleted)}catch(a){ct(w[E].error)}},user:tt,isAddingTask:Y,editingTask:$,onCancelEdit:()=>G(null)}),title:w[E].addTaskPlaceholder},{icon:"filter",children:a.jsx(A,{searchTerm:F,filterStatus:N,groupBy:q,onSearchChange:K,onFilterChange:U,onGroupByChange:z,language:E,isMobile:rt,disabled:H}),title:w[E].filterPlaceholder}]}),H?a.jsx(r,{alignItems:"center",flex:"grow",justifyContent:"center",children:a.jsx(i,{height:"100vh",marginTop:12,children:a.jsx(c,{show:!0,accessibilityLabel:w[E].loadingTasks})})}):a.jsx(I,{tasks:ut,onToggleTask:async t=>{try{const a=P.find((a=>a.id===t));if(!a)return;X((a=>[...a,t]));const e={...a,completed:!a.completed};tt&&e.firebaseId&&await k.updateTask(e,tt.uid);const o=P.map((a=>a.id===t?e:a));V(o)}catch(a){ct(w[E].updateTaskError)}finally{X((a=>a.filter((a=>a!==t))))}},onClearCompleted:async()=>{try{const t=P.filter((t=>t.completed)),a=t.map((t=>t.id)),e=P.filter((t=>!t.completed));if(X((t=>[...t,...a])),tt)for(const o of t)o.firebaseId&&await k.deleteTask(o.firebaseId);V(e),ct(w[E].clearCompletedSuccess)}catch(t){ct(w[E].clearCompletedError)}finally{X([])}},filterStatus:N,groupBy:q,language:E,isMobile:rt,loadingTaskIds:Q,onEditTask:G}),a.jsx(p,{show:O,message:M,onDismiss:()=>D(!1),language:E})]})]})})})}function M(){return a.jsx(D,{})}const R=document.getElementById("root");R&&O.createRoot(R).render(a.jsx(o.StrictMode,{children:a.jsx(M,{})}));
